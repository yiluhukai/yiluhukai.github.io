<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>什么是jwt | yiluhuakai</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.992cb7aa.css" as="style"><link rel="preload" href="/assets/js/app.9b56a05a.js" as="script"><link rel="preload" href="/assets/js/2.b22280cb.js" as="script"><link rel="preload" href="/assets/js/68.152c45b6.js" as="script"><link rel="prefetch" href="/assets/js/10.413ab2ab.js"><link rel="prefetch" href="/assets/js/100.2d785741.js"><link rel="prefetch" href="/assets/js/101.a9fd3349.js"><link rel="prefetch" href="/assets/js/11.99f54ddd.js"><link rel="prefetch" href="/assets/js/12.c46f64f3.js"><link rel="prefetch" href="/assets/js/13.6add00c5.js"><link rel="prefetch" href="/assets/js/14.40115781.js"><link rel="prefetch" href="/assets/js/15.c3827c6c.js"><link rel="prefetch" href="/assets/js/16.304d275d.js"><link rel="prefetch" href="/assets/js/17.006e2fe4.js"><link rel="prefetch" href="/assets/js/18.7f93828f.js"><link rel="prefetch" href="/assets/js/19.a72c6116.js"><link rel="prefetch" href="/assets/js/20.d175ff74.js"><link rel="prefetch" href="/assets/js/21.7092a034.js"><link rel="prefetch" href="/assets/js/22.1419ba41.js"><link rel="prefetch" href="/assets/js/23.ce5e3c1b.js"><link rel="prefetch" href="/assets/js/24.9f9edaa3.js"><link rel="prefetch" href="/assets/js/25.a57ae5dc.js"><link rel="prefetch" href="/assets/js/26.5ba697f1.js"><link rel="prefetch" href="/assets/js/27.9ecaa5dc.js"><link rel="prefetch" href="/assets/js/28.290c65fe.js"><link rel="prefetch" href="/assets/js/29.bdbc3eeb.js"><link rel="prefetch" href="/assets/js/3.ac44586b.js"><link rel="prefetch" href="/assets/js/30.6f37d998.js"><link rel="prefetch" href="/assets/js/31.b1ac1238.js"><link rel="prefetch" href="/assets/js/32.024f8182.js"><link rel="prefetch" href="/assets/js/33.202e11b5.js"><link rel="prefetch" href="/assets/js/34.e755ffc0.js"><link rel="prefetch" href="/assets/js/35.376b8f63.js"><link rel="prefetch" href="/assets/js/36.56735f24.js"><link rel="prefetch" href="/assets/js/37.b7d03c63.js"><link rel="prefetch" href="/assets/js/38.d9407e30.js"><link rel="prefetch" href="/assets/js/39.4f87e45d.js"><link rel="prefetch" href="/assets/js/4.a4a037c8.js"><link rel="prefetch" href="/assets/js/40.5a53ee48.js"><link rel="prefetch" href="/assets/js/41.f7fa6a68.js"><link rel="prefetch" href="/assets/js/42.3c07d4ad.js"><link rel="prefetch" href="/assets/js/43.2965402d.js"><link rel="prefetch" href="/assets/js/44.fef5da48.js"><link rel="prefetch" href="/assets/js/45.ff058ba7.js"><link rel="prefetch" href="/assets/js/46.5a74f2cd.js"><link rel="prefetch" href="/assets/js/47.5931bb97.js"><link rel="prefetch" href="/assets/js/48.cbf85ab3.js"><link rel="prefetch" href="/assets/js/49.0319f8e4.js"><link rel="prefetch" href="/assets/js/5.d0d45788.js"><link rel="prefetch" href="/assets/js/50.497cb73f.js"><link rel="prefetch" href="/assets/js/51.4b6e5c5b.js"><link rel="prefetch" href="/assets/js/52.f4edf34f.js"><link rel="prefetch" href="/assets/js/53.df9c0557.js"><link rel="prefetch" href="/assets/js/54.1654be3b.js"><link rel="prefetch" href="/assets/js/55.c9e37e1f.js"><link rel="prefetch" href="/assets/js/56.052c5808.js"><link rel="prefetch" href="/assets/js/57.cf8cebef.js"><link rel="prefetch" href="/assets/js/58.220252cd.js"><link rel="prefetch" href="/assets/js/59.7e76271a.js"><link rel="prefetch" href="/assets/js/6.b5583d51.js"><link rel="prefetch" href="/assets/js/60.38c88311.js"><link rel="prefetch" href="/assets/js/61.c4b0da1c.js"><link rel="prefetch" href="/assets/js/62.d8be952c.js"><link rel="prefetch" href="/assets/js/63.19c02fd0.js"><link rel="prefetch" href="/assets/js/64.9d51d342.js"><link rel="prefetch" href="/assets/js/65.31c63e7c.js"><link rel="prefetch" href="/assets/js/66.badcb6df.js"><link rel="prefetch" href="/assets/js/67.83764c63.js"><link rel="prefetch" href="/assets/js/69.2119cafb.js"><link rel="prefetch" href="/assets/js/7.d21b1042.js"><link rel="prefetch" href="/assets/js/70.ff7211f3.js"><link rel="prefetch" href="/assets/js/71.26e7783e.js"><link rel="prefetch" href="/assets/js/72.dc5a3ba6.js"><link rel="prefetch" href="/assets/js/73.d8356ad1.js"><link rel="prefetch" href="/assets/js/74.10184aff.js"><link rel="prefetch" href="/assets/js/75.716811ca.js"><link rel="prefetch" href="/assets/js/76.046e6155.js"><link rel="prefetch" href="/assets/js/77.d287e80f.js"><link rel="prefetch" href="/assets/js/78.635ed9d3.js"><link rel="prefetch" href="/assets/js/79.4485123f.js"><link rel="prefetch" href="/assets/js/8.8bd3dfa9.js"><link rel="prefetch" href="/assets/js/80.74fc122c.js"><link rel="prefetch" href="/assets/js/81.cb3ce31c.js"><link rel="prefetch" href="/assets/js/82.bf81591e.js"><link rel="prefetch" href="/assets/js/83.01b0002d.js"><link rel="prefetch" href="/assets/js/84.6af4ae46.js"><link rel="prefetch" href="/assets/js/85.31122a7c.js"><link rel="prefetch" href="/assets/js/86.7641b1ab.js"><link rel="prefetch" href="/assets/js/87.63912fdd.js"><link rel="prefetch" href="/assets/js/88.01d6d061.js"><link rel="prefetch" href="/assets/js/89.ec494ad7.js"><link rel="prefetch" href="/assets/js/9.17f8341c.js"><link rel="prefetch" href="/assets/js/90.a2905192.js"><link rel="prefetch" href="/assets/js/91.5b1b5e00.js"><link rel="prefetch" href="/assets/js/92.f8112523.js"><link rel="prefetch" href="/assets/js/93.8e9fd5a8.js"><link rel="prefetch" href="/assets/js/94.41217af6.js"><link rel="prefetch" href="/assets/js/95.b253d44f.js"><link rel="prefetch" href="/assets/js/96.76495ed0.js"><link rel="prefetch" href="/assets/js/97.9f48729e.js"><link rel="prefetch" href="/assets/js/98.0e36c4a8.js"><link rel="prefetch" href="/assets/js/99.5b6ab9af.js">
    <link rel="stylesheet" href="/assets/css/0.styles.992cb7aa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">yiluhuakai</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/leetcode/" class="nav-link">
  LeetCode
</a></div><div class="nav-item"><a href="/golang/" class="nav-link router-link-active">
  Go
</a></div><div class="nav-item"><a href="/mysql/" class="nav-link">
  Mysql
</a></div><div class="nav-item"><a href="/clang/" class="nav-link">
  C语言
</a></div><div class="nav-item"><a href="/es/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/nodejs/" class="nav-link">
  nodejs
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/java/" class="nav-link">
  Java
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/leetcode/" class="nav-link">
  LeetCode
</a></div><div class="nav-item"><a href="/golang/" class="nav-link router-link-active">
  Go
</a></div><div class="nav-item"><a href="/mysql/" class="nav-link">
  Mysql
</a></div><div class="nav-item"><a href="/clang/" class="nav-link">
  C语言
</a></div><div class="nav-item"><a href="/es/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/nodejs/" class="nav-link">
  nodejs
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/java/" class="nav-link">
  Java
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/golang/cookie.html" class="sidebar-link">cookie 和 session</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/golang/redis.html" class="sidebar-link">redis 的使用</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/golang/go-connect-db.html" class="sidebar-link">golang 链接数据库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/golang/go-connect-db.html#原理" class="sidebar-link">原理</a></li><li class="sidebar-sub-header"><a href="/golang/go-connect-db.html#查询数据" class="sidebar-link">查询数据</a></li><li class="sidebar-sub-header"><a href="/golang/go-connect-db.html#预处理" class="sidebar-link">预处理</a></li><li class="sidebar-sub-header"><a href="/golang/go-connect-db.html#事务" class="sidebar-link">事务</a></li><li class="sidebar-sub-header"><a href="/golang/go-connect-db.html#sqlx-库" class="sidebar-link">sqlx 库</a></li><li class="sidebar-sub-header"><a href="/golang/go-connect-db.html#sql-注入" class="sidebar-link">sql 注入</a></li><li class="sidebar-sub-header"><a href="/golang/go-connect-db.html#防止-sql-注入的方法" class="sidebar-link">防止 sql 注入的方法：</a></li><li class="sidebar-sub-header"><a href="/golang/go-connect-db.html#数据库查询错误" class="sidebar-link">数据库查询错误</a></li><li class="sidebar-sub-header"><a href="/golang/go-connect-db.html#查询的字段值包含关键字" class="sidebar-link">查询的字段值包含关键字</a></li><li class="sidebar-sub-header"><a href="/golang/go-connect-db.html#分页查询" class="sidebar-link">分页查询</a></li><li class="sidebar-sub-header"><a href="/golang/go-connect-db.html#in-模糊查询" class="sidebar-link">in 模糊查询</a></li><li class="sidebar-sub-header"><a href="/golang/go-connect-db.html#错误" class="sidebar-link">错误</a></li></ul></li><li><a href="/golang/beego.html" class="sidebar-link">创建一个beego应用</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/golang/beego2.html" class="sidebar-link">配置文件</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/golang/beego3.html" class="sidebar-link">session</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/golang/go-jwt.html" aria-current="page" class="active sidebar-link">什么是jwt</a><ul class="sidebar-sub-headers"></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="什么是jwt"><a href="#什么是jwt" class="header-anchor">#</a> 什么是jwt</h3> <div class="language-tex line-numbers-mode"><pre class="language-tex"><code>Json web token (JWT), 是为了在网络应用环境间传递声明而执行的一种基于JSON的开放标准（(RFC 7519).该token被设计为紧凑且安全的，特别适用于分布式站点的单点登录（SSO）场景。JWT的声明一般被用来在身份提供者和服务提供者间传递被认证的用户身份信息，以便于从资源服务器获取资源，也可以增加一些额外的其它业务逻辑所必须的声明信息，该token也可直接被用于认证，也可被加密。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="jwt的组成"><a href="#jwt的组成" class="header-anchor">#</a> jwt的组成</h3> <ul><li><strong>header</strong> <ul><li>jwt的头部承载两部分信息：</li> <li>声明类型，这里是jwt</li> <li>声明加密的算法 通常直接使用 HMAC SHA256</li></ul></li></ul> <p>完整的头部就像下面这样的JSON：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  'typ'<span class="token operator">:</span> 'JWT'<span class="token punctuation">,</span>
  'alg'<span class="token operator">:</span> 'HS256'
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>将头部的信息序列化后转化为base.</p> <ul><li><h3 id="playload"><a href="#playload" class="header-anchor">#</a> playload</h3> <ul><li><p>载荷就是存放有效信息的地方。这个名字像是特指飞机上承载的货品，这些有效信息包含三个部分</p> <ul><li>标准中注册的声明</li> <li>公共的声明</li> <li>私有的声明</li></ul></li> <li><p>标准中注册的声明** (建议但不强制使用) ：</p> <ul><li><strong>iss</strong>: jwt签发者</li> <li><strong>sub</strong>: jwt所面向的用户</li> <li><strong>aud</strong>: 接收jwt的一方</li> <li><strong>exp</strong>: jwt的过期时间，这个过期时间必须要大于签发时间</li> <li><strong>nbf</strong>: 定义在什么时间之前，该jwt都是不可用的.</li> <li><strong>iat</strong>: jwt的签发时间</li> <li><strong>jti</strong>: jwt的唯一身份标识，主要用来作为一次性token,从而回避重放攻击。</li></ul></li> <li><p>公共的声明** ：
公共的声明可以添加任何的信息，一般添加用户的相关信息或其他业务需要的必要信息.但不建议添加敏感信息，因为该部分在客户端可解密.</p></li> <li><p><strong>私有的声明</strong> ：
私有声明是提供者和消费者所共同定义的声明，一般不建议存放敏感信息，因为base64是对称解密的，意味着该部分信息可以归类为明文信息。</p></li></ul></li></ul> <p>定义一个<code>payload</code></p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;sub&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;1234567890&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;John Doe&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;admin&quot;</span><span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>然后将其进行base64加密，得到Jwt的第二部分。</p> <ul><li><strong>signature</strong> <ul><li>header (base64后的)</li> <li>payload (base64后的)</li> <li>secret</li></ul></li></ul> <p>这个部分需要base64加密后的header和base64加密后的payload使用<code>.</code>连接组成的字符串，然后通过header中声明的加密方式进行加盐<code>secret</code>组合加密，然后就构成了jwt的第三部分。</p> <h4 id="iris框架中使用jwt"><a href="#iris框架中使用jwt" class="header-anchor">#</a> <code>iris框架中使用jwt</code></h4> <ul><li><code>jwt</code>在<code>iris</code>中是以一个<code>middleware</code>的形式存在的</li> <li>其中的生成<code>jwt</code>的过程和上面的描述的类似</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;github.com/iris-contrib/middleware/jwt&quot;</span>
	<span class="token string">&quot;github.com/kataras/iris/v12&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">getTokenHandler</span><span class="token punctuation">(</span>ctx iris<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	token <span class="token operator">:=</span> jwt<span class="token punctuation">.</span><span class="token function">NewTokenWithClaims</span><span class="token punctuation">(</span>jwt<span class="token punctuation">.</span>SigningMethodHS256<span class="token punctuation">,</span> jwt<span class="token punctuation">.</span>MapClaims<span class="token punctuation">{</span>
		<span class="token string">&quot;sub&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;1234567890&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;John Doe&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;admin&quot;</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token comment">// Sign and get the complete encoded token as a string using the secret</span>
	tokenString<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> token<span class="token punctuation">.</span><span class="token function">SignedString</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;My Secret&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	ctx<span class="token punctuation">.</span><span class="token function">HTML</span><span class="token punctuation">(</span><span class="token string">`Token: `</span> <span class="token operator">+</span> tokenString <span class="token operator">+</span> <span class="token string">`&lt;br/&gt;&lt;br/&gt;
    &lt;a href=&quot;/secured?token=`</span> <span class="token operator">+</span> tokenString <span class="token operator">+</span> <span class="token string">`&quot;&gt;/secured?token=`</span> <span class="token operator">+</span> tokenString <span class="token operator">+</span> <span class="token string">`&lt;/a&gt;`</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">myAuthenticatedHandler</span><span class="token punctuation">(</span>ctx iris<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	user <span class="token operator">:=</span> ctx<span class="token punctuation">.</span><span class="token function">Values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;jwt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>jwt<span class="token punctuation">.</span>Token<span class="token punctuation">)</span>

	ctx<span class="token punctuation">.</span><span class="token function">Writef</span><span class="token punctuation">(</span><span class="token string">&quot;This is an authenticated request\n&quot;</span><span class="token punctuation">)</span>
	ctx<span class="token punctuation">.</span><span class="token function">Writef</span><span class="token punctuation">(</span><span class="token string">&quot;Claim content:\n&quot;</span><span class="token punctuation">)</span>

	foobar <span class="token operator">:=</span> user<span class="token punctuation">.</span>Claims<span class="token punctuation">.</span><span class="token punctuation">(</span>jwt<span class="token punctuation">.</span>MapClaims<span class="token punctuation">)</span>
	<span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token operator">:=</span> <span class="token keyword">range</span> foobar <span class="token punctuation">{</span>
		ctx<span class="token punctuation">.</span><span class="token function">Writef</span><span class="token punctuation">(</span><span class="token string">&quot;%s = %s&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	app <span class="token operator">:=</span> iris<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	j <span class="token operator">:=</span> jwt<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>jwt<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
		<span class="token comment">// Extract by &quot;token&quot; url parameter.</span>
		Extractor<span class="token punctuation">:</span> jwt<span class="token punctuation">.</span><span class="token function">FromParameter</span><span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

		ValidationKeyGetter<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>token <span class="token operator">*</span>jwt<span class="token punctuation">.</span>Token<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;My Secret&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		SigningMethod<span class="token punctuation">:</span> jwt<span class="token punctuation">.</span>SigningMethodHS256<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	app<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> getTokenHandler<span class="token punctuation">)</span>
	app<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;/secured&quot;</span><span class="token punctuation">,</span> j<span class="token punctuation">.</span>Serve<span class="token punctuation">,</span> myAuthenticatedHandler<span class="token punctuation">)</span>
	app<span class="token punctuation">.</span><span class="token function">Listen</span><span class="token punctuation">(</span><span class="token string">&quot;:8081&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><p><code>生成jwt</code>:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// 设置head 和payload</span>
token <span class="token operator">:</span>= jwt.NewTokenWithClaims(jwt.SigningMethodHS256<span class="token punctuation">,</span> jwt.MapClaims<span class="token punctuation">{</span>
		<span class="token property">&quot;sub&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1234567890&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;John Doe&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;admin&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>)

<span class="token comment">// add salt</span>
tokenString<span class="token punctuation">,</span> _ <span class="token operator">:</span>= token.SignedString(<span class="token punctuation">[</span><span class="token punctuation">]</span>byte(<span class="token string">&quot;My Secret&quot;</span>))
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>底层实现：</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">var</span> <span class="token punctuation">(</span>
	NewToken           <span class="token operator">=</span> jwt<span class="token punctuation">.</span>New
	NewTokenWithClaims <span class="token operator">=</span> jwt<span class="token punctuation">.</span>NewWithClaims
<span class="token punctuation">)</span>
<span class="token comment">// 生成一个未加盐的token</span>
<span class="token keyword">func</span> <span class="token function">NewWithClaims</span><span class="token punctuation">(</span>method SigningMethod<span class="token punctuation">,</span> claims Claims<span class="token punctuation">)</span> <span class="token operator">*</span>Token <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>Token<span class="token punctuation">{</span>
		Header<span class="token punctuation">:</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span>
			<span class="token string">&quot;typ&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;JWT&quot;</span><span class="token punctuation">,</span>
			<span class="token string">&quot;alg&quot;</span><span class="token punctuation">:</span> method<span class="token punctuation">.</span><span class="token function">Alg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		Claims<span class="token punctuation">:</span> claims<span class="token punctuation">,</span>
		Method<span class="token punctuation">:</span> method<span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 加盐的底层实现</span>
<span class="token comment">// Get the complete, signed token</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>t <span class="token operator">*</span>Token<span class="token punctuation">)</span> <span class="token function">SignedString</span><span class="token punctuation">(</span>key <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> sig<span class="token punctuation">,</span> sstr <span class="token builtin">string</span>
	<span class="token keyword">var</span> err <span class="token builtin">error</span>
	<span class="token keyword">if</span> sstr<span class="token punctuation">,</span> err <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">SigningString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
  <span class="token comment">// 加盐</span>
	<span class="token keyword">if</span> sig<span class="token punctuation">,</span> err <span class="token operator">=</span> t<span class="token punctuation">.</span>Method<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>sstr<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
  <span class="token comment">// 将header和payload转成base64后再和加盐生成的sig拼接形成token</span>
	<span class="token keyword">return</span> strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span>sstr<span class="token punctuation">,</span> sig<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
<span class="token comment">// 将header和payload转成base64并用`.`连接</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>t <span class="token operator">*</span>Token<span class="token punctuation">)</span> <span class="token function">SigningString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> err <span class="token builtin">error</span>
	parts <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> <span class="token keyword">range</span> parts <span class="token punctuation">{</span>
		<span class="token keyword">var</span> jsonValue <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
		<span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> jsonValue<span class="token punctuation">,</span> err <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>Header<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> err
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> jsonValue<span class="token punctuation">,</span> err <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>Claims<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> err
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		parts<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">EncodeSegment</span><span class="token punctuation">(</span>jsonValue<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>parts<span class="token punctuation">,</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>


<span class="token comment">// Encode JWT specific base64url encoding with padding stripped</span>
<span class="token keyword">func</span> <span class="token function">EncodeSegment</span><span class="token punctuation">(</span>seg <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> strings<span class="token punctuation">.</span><span class="token function">TrimRight</span><span class="token punctuation">(</span>base64<span class="token punctuation">.</span>URLEncoding<span class="token punctuation">.</span><span class="token function">EncodeToString</span><span class="token punctuation">(</span>seg<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;=&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token comment">// 加盐的具体过程</span>
<span class="token comment">// Implements the Sign method from SigningMethod for this signing method.</span>
<span class="token comment">// Key must be []byte</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>SigningMethodHMAC<span class="token punctuation">)</span> <span class="token function">Sign</span><span class="token punctuation">(</span>signingString <span class="token builtin">string</span><span class="token punctuation">,</span> key <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> keyBytes<span class="token punctuation">,</span> ok <span class="token operator">:=</span> key<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token operator">!</span>m<span class="token punctuation">.</span>Hash<span class="token punctuation">.</span><span class="token function">Available</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> ErrHashUnavailable
		<span class="token punctuation">}</span>

		hasher <span class="token operator">:=</span> hmac<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>Hash<span class="token punctuation">.</span>New<span class="token punctuation">,</span> keyBytes<span class="token punctuation">)</span>
		hasher<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>signingString<span class="token punctuation">)</span><span class="token punctuation">)</span>

		<span class="token keyword">return</span> <span class="token function">EncodeSegment</span><span class="token punctuation">(</span>hasher<span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> ErrInvalidKeyType
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br></div></div><ul><li>验证生成的token</li></ul> <div class="language-go line-numbers-mode"><pre class="language-go"><code>j <span class="token operator">:=</span> jwt<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>jwt<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
  <span class="token comment">// Extract by &quot;token&quot; url parameter.</span>
  <span class="token comment">// 从form中提取tokenzi字段</span>
  Extractor<span class="token punctuation">:</span> jwt<span class="token punctuation">.</span><span class="token function">FromParameter</span><span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  ValidationKeyGetter<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span>token <span class="token operator">*</span>jwt<span class="token punctuation">.</span>Token<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;My Secret&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  SigningMethod<span class="token punctuation">:</span> jwt<span class="token punctuation">.</span>SigningMethodHS256<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// j.Serves是一个中间价</span>
app<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;/secured&quot;</span><span class="token punctuation">,</span> j<span class="token punctuation">.</span>Serve<span class="token punctuation">,</span> myAuthenticatedHandler<span class="token punctuation">)</span>


<span class="token comment">///// Serve the middleware's action</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Middleware<span class="token punctuation">)</span> <span class="token function">Serve</span><span class="token punctuation">(</span>ctx iris<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> m<span class="token punctuation">.</span><span class="token function">CheckJWT</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		m<span class="token punctuation">.</span>Config<span class="token punctuation">.</span><span class="token function">ErrorHandler</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// If everything ok then call next.</span>
	ctx<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><code>m.CheckJWT(ctx)</code>方法：</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// CheckJWT the main functionality, checks for token</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>Middleware<span class="token punctuation">)</span> <span class="token function">CheckJWT</span><span class="token punctuation">(</span>ctx iris<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>m<span class="token punctuation">.</span>Config<span class="token punctuation">.</span>EnableAuthOnOptions <span class="token punctuation">{</span>
		<span class="token keyword">if</span> ctx<span class="token punctuation">.</span><span class="token function">Method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> iris<span class="token punctuation">.</span>MethodOptions <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token boolean">nil</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Use the specified token extractor to extract a token from the request</span>
	token<span class="token punctuation">,</span> err <span class="token operator">:=</span> m<span class="token punctuation">.</span>Config<span class="token punctuation">.</span><span class="token function">Extractor</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>

	<span class="token comment">// If debugging is turned on, log the outcome</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">logf</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token string">&quot;Error extracting JWT: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span> err
	<span class="token punctuation">}</span>

	<span class="token function">logf</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token string">&quot;Token extracted: %s&quot;</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span>

	<span class="token comment">// If the token is empty...</span>
	<span class="token keyword">if</span> token <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span>
		<span class="token comment">// Check if it was required</span>
		<span class="token keyword">if</span> m<span class="token punctuation">.</span>Config<span class="token punctuation">.</span>CredentialsOptional <span class="token punctuation">{</span>
			<span class="token function">logf</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token string">&quot;No credentials found (CredentialsOptional=true)&quot;</span><span class="token punctuation">)</span>
			<span class="token comment">// No error, just no token (and that is ok given that CredentialsOptional is true)</span>
			<span class="token keyword">return</span> <span class="token boolean">nil</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// If we get here, the required token is missing</span>
		<span class="token function">logf</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token string">&quot;Error: No credentials found (CredentialsOptional=false)&quot;</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> ErrTokenMissing
	<span class="token punctuation">}</span>

	<span class="token comment">// Now parse the token</span>

	parsedToken<span class="token punctuation">,</span> err <span class="token operator">:=</span> jwtParser<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> m<span class="token punctuation">.</span>Config<span class="token punctuation">.</span>ValidationKeyGetter<span class="token punctuation">)</span>
	<span class="token comment">// Check if there was an error in parsing...</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">logf</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token string">&quot;Error parsing token: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span> err
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> m<span class="token punctuation">.</span>Config<span class="token punctuation">.</span>SigningMethod <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> m<span class="token punctuation">.</span>Config<span class="token punctuation">.</span>SigningMethod<span class="token punctuation">.</span><span class="token function">Alg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> parsedToken<span class="token punctuation">.</span>Header<span class="token punctuation">[</span><span class="token string">&quot;alg&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
		err <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;Expected %s signing method but token specified %s&quot;</span><span class="token punctuation">,</span>
			m<span class="token punctuation">.</span>Config<span class="token punctuation">.</span>SigningMethod<span class="token punctuation">.</span><span class="token function">Alg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			parsedToken<span class="token punctuation">.</span>Header<span class="token punctuation">[</span><span class="token string">&quot;alg&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token function">logf</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token string">&quot;Error validating token algorithm: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span> err
	<span class="token punctuation">}</span>

	<span class="token comment">// Check if the parsed token is valid...</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>parsedToken<span class="token punctuation">.</span>Valid <span class="token punctuation">{</span>
		<span class="token function">logf</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token string">&quot;Token is invalid&quot;</span><span class="token punctuation">)</span>
		<span class="token comment">// m.Config.ErrorHandler(ctx, ErrTokenInvalid)</span>
		<span class="token keyword">return</span> ErrTokenInvalid
	<span class="token punctuation">}</span>
	<span class="token comment">// 验证token过期</span>
	<span class="token keyword">if</span> m<span class="token punctuation">.</span>Config<span class="token punctuation">.</span>Expiration <span class="token punctuation">{</span>
		<span class="token keyword">if</span> claims<span class="token punctuation">,</span> ok <span class="token operator">:=</span> parsedToken<span class="token punctuation">.</span>Claims<span class="token punctuation">.</span><span class="token punctuation">(</span>jwt<span class="token punctuation">.</span>MapClaims<span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>
			<span class="token keyword">if</span> expired <span class="token operator">:=</span> claims<span class="token punctuation">.</span><span class="token function">VerifyExpiresAt</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">!</span>expired <span class="token punctuation">{</span>
				<span class="token function">logf</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token string">&quot;Token is expired&quot;</span><span class="token punctuation">)</span>
				<span class="token keyword">return</span> ErrTokenExpired
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token function">logf</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token string">&quot;JWT: %v&quot;</span><span class="token punctuation">,</span> parsedToken<span class="token punctuation">)</span>

	<span class="token comment">// If we get here, everything worked and we can set the</span>
	<span class="token comment">// user property in context.</span>
	ctx<span class="token punctuation">.</span><span class="token function">Values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>Config<span class="token punctuation">.</span>ContextKey<span class="token punctuation">,</span> parsedToken<span class="token punctuation">)</span>

	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br></div></div><p><a href="https://www.jianshu.com/p/576dbf44b2ae" target="_blank" rel="noopener noreferrer">参考博客<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>​</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/golang/beego3.html" class="prev">
        session
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9b56a05a.js" defer></script><script src="/assets/js/2.b22280cb.js" defer></script><script src="/assets/js/68.152c45b6.js" defer></script>
  </body>
</html>
