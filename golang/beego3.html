<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>session | yiluhuakai</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.775e5fee.css" as="style"><link rel="preload" href="/assets/js/app.6fb23a83.js" as="script"><link rel="preload" href="/assets/js/2.b22280cb.js" as="script"><link rel="preload" href="/assets/js/47.74ec33ae.js" as="script"><link rel="prefetch" href="/assets/js/10.40461a30.js"><link rel="prefetch" href="/assets/js/11.d103858e.js"><link rel="prefetch" href="/assets/js/12.4232f768.js"><link rel="prefetch" href="/assets/js/13.b3734304.js"><link rel="prefetch" href="/assets/js/14.f2386497.js"><link rel="prefetch" href="/assets/js/15.308a89ff.js"><link rel="prefetch" href="/assets/js/16.db389cec.js"><link rel="prefetch" href="/assets/js/17.cf828fcb.js"><link rel="prefetch" href="/assets/js/18.899e9438.js"><link rel="prefetch" href="/assets/js/19.580699e9.js"><link rel="prefetch" href="/assets/js/20.332c8709.js"><link rel="prefetch" href="/assets/js/21.375795c8.js"><link rel="prefetch" href="/assets/js/22.50502a93.js"><link rel="prefetch" href="/assets/js/23.687897f9.js"><link rel="prefetch" href="/assets/js/24.ebc77e7a.js"><link rel="prefetch" href="/assets/js/25.337c6ea9.js"><link rel="prefetch" href="/assets/js/26.e762b5ea.js"><link rel="prefetch" href="/assets/js/27.13464cd3.js"><link rel="prefetch" href="/assets/js/28.523d766a.js"><link rel="prefetch" href="/assets/js/29.3987be3f.js"><link rel="prefetch" href="/assets/js/3.de1a5954.js"><link rel="prefetch" href="/assets/js/30.ff074f82.js"><link rel="prefetch" href="/assets/js/31.44d32a6e.js"><link rel="prefetch" href="/assets/js/32.b9b36b40.js"><link rel="prefetch" href="/assets/js/33.abe84780.js"><link rel="prefetch" href="/assets/js/34.2fb44918.js"><link rel="prefetch" href="/assets/js/35.a3098855.js"><link rel="prefetch" href="/assets/js/36.05c89a1c.js"><link rel="prefetch" href="/assets/js/37.27eda115.js"><link rel="prefetch" href="/assets/js/38.1dff405e.js"><link rel="prefetch" href="/assets/js/39.35c28552.js"><link rel="prefetch" href="/assets/js/4.e26bf81a.js"><link rel="prefetch" href="/assets/js/40.6405a5c2.js"><link rel="prefetch" href="/assets/js/41.34a3cdb8.js"><link rel="prefetch" href="/assets/js/42.18986dd4.js"><link rel="prefetch" href="/assets/js/43.7fdfe078.js"><link rel="prefetch" href="/assets/js/44.283ea1af.js"><link rel="prefetch" href="/assets/js/45.6778b0eb.js"><link rel="prefetch" href="/assets/js/46.c9d8e532.js"><link rel="prefetch" href="/assets/js/48.e6419c54.js"><link rel="prefetch" href="/assets/js/49.a850af05.js"><link rel="prefetch" href="/assets/js/5.ce8ed43a.js"><link rel="prefetch" href="/assets/js/50.7a85f1c4.js"><link rel="prefetch" href="/assets/js/51.e050e509.js"><link rel="prefetch" href="/assets/js/52.4e95e579.js"><link rel="prefetch" href="/assets/js/53.2c1823d9.js"><link rel="prefetch" href="/assets/js/54.dd273805.js"><link rel="prefetch" href="/assets/js/55.ef337569.js"><link rel="prefetch" href="/assets/js/56.f0e79429.js"><link rel="prefetch" href="/assets/js/57.eab487a7.js"><link rel="prefetch" href="/assets/js/58.3060e802.js"><link rel="prefetch" href="/assets/js/59.a7db315a.js"><link rel="prefetch" href="/assets/js/6.a3856d53.js"><link rel="prefetch" href="/assets/js/60.99117954.js"><link rel="prefetch" href="/assets/js/61.805588a2.js"><link rel="prefetch" href="/assets/js/62.bb5d85a6.js"><link rel="prefetch" href="/assets/js/7.02b760da.js"><link rel="prefetch" href="/assets/js/8.78eceb25.js"><link rel="prefetch" href="/assets/js/9.196b0b91.js">
    <link rel="stylesheet" href="/assets/css/0.styles.775e5fee.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">yiluhuakai</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/leetcode/" class="nav-link">
  LeetCode
</a></div><div class="nav-item"><a href="/golang/" class="nav-link router-link-active">
  Go
</a></div><div class="nav-item"><a href="/mysql/" class="nav-link">
  Mysql
</a></div><div class="nav-item"><a href="/clang/" class="nav-link">
  C语言
</a></div><div class="nav-item"><a href="/es/" class="nav-link">
  前端
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/leetcode/" class="nav-link">
  LeetCode
</a></div><div class="nav-item"><a href="/golang/" class="nav-link router-link-active">
  Go
</a></div><div class="nav-item"><a href="/mysql/" class="nav-link">
  Mysql
</a></div><div class="nav-item"><a href="/clang/" class="nav-link">
  C语言
</a></div><div class="nav-item"><a href="/es/" class="nav-link">
  前端
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/golang/cookie.html" class="sidebar-link">cookie 和 session</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/golang/redis.html" class="sidebar-link">redis 的使用</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/golang/go链接数据库.html" class="sidebar-link">golang 链接数据库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/golang/go链接数据库.html#原理" class="sidebar-link">原理</a></li><li class="sidebar-sub-header"><a href="/golang/go链接数据库.html#查询数据" class="sidebar-link">查询数据</a></li><li class="sidebar-sub-header"><a href="/golang/go链接数据库.html#预处理" class="sidebar-link">预处理</a></li><li class="sidebar-sub-header"><a href="/golang/go链接数据库.html#事务" class="sidebar-link">事务</a></li><li class="sidebar-sub-header"><a href="/golang/go链接数据库.html#sqlx-库" class="sidebar-link">sqlx 库</a></li><li class="sidebar-sub-header"><a href="/golang/go链接数据库.html#sql-注入" class="sidebar-link">sql 注入</a></li><li class="sidebar-sub-header"><a href="/golang/go链接数据库.html#防止-sql-注入的方法" class="sidebar-link">防止 sql 注入的方法：</a></li><li class="sidebar-sub-header"><a href="/golang/go链接数据库.html#数据库查询错误" class="sidebar-link">数据库查询错误</a></li><li class="sidebar-sub-header"><a href="/golang/go链接数据库.html#查询的字段值包含关键字" class="sidebar-link">查询的字段值包含关键字</a></li><li class="sidebar-sub-header"><a href="/golang/go链接数据库.html#分页查询" class="sidebar-link">分页查询</a></li><li class="sidebar-sub-header"><a href="/golang/go链接数据库.html#in-模糊查询" class="sidebar-link">in 模糊查询</a></li><li class="sidebar-sub-header"><a href="/golang/go链接数据库.html#错误" class="sidebar-link">错误</a></li></ul></li><li><a href="/golang/beego.html" class="sidebar-link">创建一个beego应用</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/golang/beego2.html" class="sidebar-link">配置文件</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/golang/beego3.html" aria-current="page" class="active sidebar-link">session</a><ul class="sidebar-sub-headers"></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h4 id="session"><a href="#session" class="header-anchor">#</a> session</h4> <p><a href="https://beego.me/docs/mvc/controller/session.md" target="_blank" rel="noopener noreferrer">session<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>beego 内置了 session 模块，目前 session 模块支持的后端引擎包括 memory、cookie、file、mysql、redis、couchbase、memcache、postgres，用户也可以根据相应的 interface 实现自己的引擎。</p> <p>beego 中使用 session 相当方便，只要在 main 入口函数中设置如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>beego.BConfig.WebConfig.Session.SessionOn = true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>或者通过配置文件配置如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sessionon = true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>通过这种方式就可以开启 session，如何使用 session，请看下面的例子：</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>this <span class="token operator">*</span>MainController<span class="token punctuation">)</span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    v <span class="token operator">:=</span> this<span class="token punctuation">.</span><span class="token function">GetSession</span><span class="token punctuation">(</span><span class="token string">&quot;asta&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> v <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        this<span class="token punctuation">.</span><span class="token function">SetSession</span><span class="token punctuation">(</span><span class="token string">&quot;asta&quot;</span><span class="token punctuation">,</span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        this<span class="token punctuation">.</span>Data<span class="token punctuation">[</span><span class="token string">&quot;num&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        this<span class="token punctuation">.</span><span class="token function">SetSession</span><span class="token punctuation">(</span><span class="token string">&quot;asta&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
        this<span class="token punctuation">.</span>Data<span class="token punctuation">[</span><span class="token string">&quot;num&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    this<span class="token punctuation">.</span>TplName <span class="token operator">=</span> <span class="token string">&quot;index.tpl&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>session 有几个方便的方法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>SetSession(name string, value interface{})
GetSession(name string) interface{}
DelSession(name string)
SessionRegenerateID()
DestroySession()
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>session 操作主要有设置 session、获取 session、删除 session。</p> <p>session模块的其他设置</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>beego.BConfig.WebConfig.Session.SessionOn
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>设置是否开启 Session，默认是 false，配置文件对应的参数名：sessionon。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>beego.BConfig.WebConfig.Session.SessionProvider
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>设置 Session 的引擎，默认是 memory，目前支持还有 file、mysql、redis 等，配置文件对应的参数名：sessionprovider。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>beego.BConfig.WebConfig.Session.SessionName
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>设置 cookies 的名字，Session 默认是保存在用户的浏览器 cookies 里面的，默认名是 beegosessionID，配置文件对应的参数名是：sessionname。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>beego.BConfig.WebConfig.Session.SessionGCMaxLifetime
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>设置 Session 过期的时间，默认值是 3600 秒，配置文件对应的参数：sessiongcmaxlifetime。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>beego.BConfig.WebConfig.Session.SessionProviderConfig
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>设置对应 file、mysql、redis 引擎的保存路径或者链接地址，默认值是空，配置文件对应的参数：sessionproviderconfig。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>beego.BConfig.WebConfig.Session.SessionHashFunc
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>默认值为 sha1，采用 sha1 加密算法生产 sessionid</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>beego.BConfig.WebConfig.Session.SessionHashKey
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>默认的 key 是 beegoserversessionkey，建议用户使用的时候修改该参数</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>beego.BConfig.WebConfig.Session.SessionCookieLifeTime
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>设置 cookie 的过期时间，cookie 是用来存储保存在客户端的数据。</p> <h4 id="过滤器"><a href="#过滤器" class="header-anchor">#</a> 过滤器</h4> <p>beego 支持自定义过滤中间件，例如安全验证，强制跳转等。</p> <p>过滤器函数如下所示：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>beego.InsertFilter(pattern string, position int, filter FilterFunc, params ...bool)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>InsertFilter 函数的三个必填参数，一个可选参数</p> <p>pattern 路由规则，可以根据一定的规则进行路由，如果你全匹配可以用 *
position 执行 Filter 的地方，五个固定参数如下，分别表示不同的执行过程
BeforeStatic 静态地址之前
BeforeRouter 寻找路由之前
BeforeExec 找到路由之后，开始执行相应的 Controller 之前
AfterExec 执行完 Controller 逻辑之后执行的过滤器
FinishRouter 执行完逻辑之后执行的过滤器</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>filter filter 函数 type FilterFunc func(*context.Context)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>params
设置 returnOnOutput 的值(默认 true), 如果在进行到此过滤之前已经有输出，是否不再继续执行此过滤器,默认设置为如果前面已有输出(参数为true)，则不再执行此过滤器</p> <p>是否重置 filters 的参数，默认是 false，因为在 filters 的 pattern 和本身的路由的 pattern 冲突的时候，可以把 filters 的参数重置，这样可以保证在后续的逻辑中获取到正确的参数，例如设置了 /api/* 的 filter，同时又设置了 /api/docs/* 的 router，那么在访问 /api/docs/swagger/abc.js 的时候，在执行 filters 的时候设置 :splat 参数为 docs/swagger/abc.js，但是如果不清楚 filter 的这个路由参数，就会在执行路由逻辑的时候保持 docs/swagger/abc.js，如果设置了 true，就会重置 :splat 参数.</p> <p>如下例子所示，验证用户是否已经登录，应用于全部的请求：</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">var</span> FilterUser <span class="token operator">=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token boolean">_</span><span class="token punctuation">,</span> ok <span class="token operator">:=</span> ctx<span class="token punctuation">.</span>Input<span class="token punctuation">.</span><span class="token function">Session</span><span class="token punctuation">(</span><span class="token string">&quot;uid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token operator">&amp;&amp;</span> ctx<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>RequestURI <span class="token operator">!=</span> <span class="token string">&quot;/login&quot;</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span><span class="token number">302</span><span class="token punctuation">,</span> <span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

beego<span class="token punctuation">.</span><span class="token function">InsertFilter</span><span class="token punctuation">(</span><span class="token string">&quot;/*&quot;</span><span class="token punctuation">,</span>beego<span class="token punctuation">.</span>BeforeRouter<span class="token punctuation">,</span>FilterUser<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="url构建"><a href="#url构建" class="header-anchor">#</a> url构建</h4> <p>UrlFor() 函数就是用于构建指定函数的 URL 的。它把对应控制器和函数名结合的字符串作为第一个参数，其余参数对应 URL 中的变量。未知变量将添加到 URL 中作为查询参数</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> TestController <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    beego<span class="token punctuation">.</span>Controller
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>this <span class="token operator">*</span>TestController<span class="token punctuation">)</span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this<span class="token punctuation">.</span>Data<span class="token punctuation">[</span><span class="token string">&quot;Username&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;astaxie&quot;</span>
    this<span class="token punctuation">.</span>Ctx<span class="token punctuation">.</span>Output<span class="token punctuation">.</span><span class="token function">Body</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>this <span class="token operator">*</span>TestController<span class="token punctuation">)</span> <span class="token function">List</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this<span class="token punctuation">.</span>Ctx<span class="token punctuation">.</span>Output<span class="token punctuation">.</span><span class="token function">Body</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;i am list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>this <span class="token operator">*</span>TestController<span class="token punctuation">)</span> <span class="token function">Params</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this<span class="token punctuation">.</span>Ctx<span class="token punctuation">.</span>Output<span class="token punctuation">.</span><span class="token function">Body</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>this<span class="token punctuation">.</span>Ctx<span class="token punctuation">.</span>Input<span class="token punctuation">.</span><span class="token function">Params</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span> this<span class="token punctuation">.</span>Ctx<span class="token punctuation">.</span>Input<span class="token punctuation">.</span><span class="token function">Params</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">]</span> <span class="token operator">+</span> this<span class="token punctuation">.</span>Ctx<span class="token punctuation">.</span>Input<span class="token punctuation">.</span><span class="token function">Params</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>this <span class="token operator">*</span>TestController<span class="token punctuation">)</span> <span class="token function">Myext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this<span class="token punctuation">.</span>Ctx<span class="token punctuation">.</span>Output<span class="token punctuation">.</span><span class="token function">Body</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>this<span class="token punctuation">.</span>Ctx<span class="token punctuation">.</span>Input<span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">&quot;:ext&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>this <span class="token operator">*</span>TestController<span class="token punctuation">)</span> <span class="token function">GetUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this<span class="token punctuation">.</span>Ctx<span class="token punctuation">.</span>Output<span class="token punctuation">.</span><span class="token function">Body</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>this<span class="token punctuation">.</span><span class="token function">UrlFor</span><span class="token punctuation">(</span><span class="token string">&quot;.Myext&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>对应的router</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>beego<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token string">&quot;/api/list&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>TestController<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;*:List&quot;</span><span class="token punctuation">)</span>
beego<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token string">&quot;/person/:last/:first&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>TestController<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
beego<span class="token punctuation">.</span><span class="token function">AutoRouter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>TestController<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>后端去获取url</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>beego<span class="token punctuation">.</span><span class="token function">URLFor</span><span class="token punctuation">(</span><span class="token string">&quot;TestController.List&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// 输出 /api/list</span>

beego<span class="token punctuation">.</span><span class="token function">URLFor</span><span class="token punctuation">(</span><span class="token string">&quot;TestController.Get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;:last&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;xie&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;:first&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;asta&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// 输出 /person/xie/asta</span>

beego<span class="token punctuation">.</span><span class="token function">URLFor</span><span class="token punctuation">(</span><span class="token string">&quot;TestController.Myext&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// 输出 /Test/Myext</span>

beego<span class="token punctuation">.</span><span class="token function">URLFor</span><span class="token punctuation">(</span><span class="token string">&quot;TestController.GetUrl&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// 输出 /Test/GetUrl</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>前端模版中去使用</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span>  <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>{{urlfor <span class="token punctuation">&quot;</span>TestController.List<span class="token punctuation">&quot;</span>}}<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span> 

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>为什么不在把 URL 写死在模板中，反而要动态构建？有两个很好的理由：
反向解析通常比硬编码 URL 更直观。同时，更重要的是你可以只在一个地方改变 URL ，而不用到处乱找。
URL 创建会为你处理特殊字符的转义和 Unicode 数据，不用你操心</p> <h4 id="表单验证是用于数据验证和错误收集的模块。"><a href="#表单验证是用于数据验证和错误收集的模块。" class="header-anchor">#</a> 表单验证是用于数据验证和错误收集的模块。</h4> <p>安装：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>go get github.com/astaxie/beego/validation
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>测试：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>go test github.com/astaxie/beego/validation
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>直接校验字段</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;github.com/astaxie/beego/validation&quot;</span>
    <span class="token string">&quot;log&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Name <span class="token builtin">string</span>
    Age <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    u <span class="token operator">:=</span> User<span class="token punctuation">{</span><span class="token string">&quot;man&quot;</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">}</span>
    valid <span class="token operator">:=</span> validation<span class="token punctuation">.</span>Validation<span class="token punctuation">{</span><span class="token punctuation">}</span>
    valid<span class="token punctuation">.</span><span class="token function">Required</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span>
    valid<span class="token punctuation">.</span><span class="token function">MaxSize</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token string">&quot;nameMax&quot;</span><span class="token punctuation">)</span>
    valid<span class="token punctuation">.</span><span class="token function">Range</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>Age<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> valid<span class="token punctuation">.</span><span class="token function">HasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果有错误信息，证明验证没通过</span>
        <span class="token comment">// 打印错误信息</span>
        <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token keyword">range</span> valid<span class="token punctuation">.</span>Errors <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>Key<span class="token punctuation">,</span> err<span class="token punctuation">.</span>Message<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// or use like this</span>
    <span class="token keyword">if</span> v <span class="token operator">:=</span> valid<span class="token punctuation">.</span><span class="token function">Max</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>Age<span class="token punctuation">,</span> <span class="token number">140</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">!</span>v<span class="token punctuation">.</span>Ok <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>Error<span class="token punctuation">.</span>Key<span class="token punctuation">,</span> v<span class="token punctuation">.</span>Error<span class="token punctuation">.</span>Message<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 定制错误信息</span>
    minAge <span class="token operator">:=</span> <span class="token number">18</span>
    valid<span class="token punctuation">.</span><span class="token function">Min</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>Age<span class="token punctuation">,</span> minAge<span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Message</span><span class="token punctuation">(</span><span class="token string">&quot;少儿不宜！&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">// 错误信息格式化</span>
    valid<span class="token punctuation">.</span><span class="token function">Min</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>Age<span class="token punctuation">,</span> minAge<span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Message</span><span class="token punctuation">(</span><span class="token string">&quot;%d不禁&quot;</span><span class="token punctuation">,</span> minAge<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>使用tag</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;log&quot;</span>
    <span class="token string">&quot;strings&quot;</span>

    <span class="token string">&quot;github.com/astaxie/beego/validation&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// 验证函数写在 &quot;valid&quot; tag 的标签里</span>
<span class="token comment">// 各个函数之间用分号 &quot;;&quot; 分隔，分号后面可以有空格</span>
<span class="token comment">// 参数用括号 &quot;()&quot; 括起来，多个参数之间用逗号 &quot;,&quot; 分开，逗号后面可以有空格</span>
<span class="token comment">// 正则函数(Match)的匹配模式用两斜杠 &quot;/&quot; 括起来</span>
<span class="token comment">// 各个函数的结果的 key 值为字段名.验证函数名</span>
<span class="token keyword">type</span> user <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Id     <span class="token builtin">int</span>
    Name   <span class="token builtin">string</span> <span class="token string">`valid:&quot;Required;Match(/^Bee.*/)&quot;`</span> <span class="token comment">// Name 不能为空并且以 Bee 开头</span>
    Age    <span class="token builtin">int</span>    <span class="token string">`valid:&quot;Range(1, 140)&quot;`</span> <span class="token comment">// 1 &lt;= Age &lt;= 140，超出此范围即为不合法</span>
    Email  <span class="token builtin">string</span> <span class="token string">`valid:&quot;Email; MaxSize(100)&quot;`</span> <span class="token comment">// Email 字段需要符合邮箱格式，并且最大长度不能大于 100 个字符</span>
    Mobile <span class="token builtin">string</span> <span class="token string">`valid:&quot;Mobile&quot;`</span> <span class="token comment">// Mobile 必须为正确的手机号</span>
    IP     <span class="token builtin">string</span> <span class="token string">`valid:&quot;IP&quot;`</span> <span class="token comment">// IP 必须为一个正确的 IPv4 地址</span>
<span class="token punctuation">}</span>

<span class="token comment">// 如果你的 struct 实现了接口 validation.ValidFormer</span>
<span class="token comment">// 当 StructTag 中的测试都成功时，将会执行 Valid 函数进行自定义验证</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>u <span class="token operator">*</span>user<span class="token punctuation">)</span> <span class="token function">Valid</span><span class="token punctuation">(</span>v <span class="token operator">*</span>validation<span class="token punctuation">.</span>Validation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> strings<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">{</span>
        <span class="token comment">// 通过 SetError 设置 Name 的错误信息，HasErrors 将会返回 true</span>
        v<span class="token punctuation">.</span><span class="token function">SetError</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;名称里不能含有 admin&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 可以接受一个错误信息的map去修改err.Message</span>
    valid <span class="token operator">:=</span> validation<span class="token punctuation">.</span>Validation<span class="token punctuation">{</span><span class="token punctuation">}</span>
    u <span class="token operator">:=</span> user<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;Beego&quot;</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> Email<span class="token punctuation">:</span> <span class="token string">&quot;dev@beego.me&quot;</span><span class="token punctuation">}</span>
    b<span class="token punctuation">,</span> err <span class="token operator">:=</span> valid<span class="token punctuation">.</span><span class="token function">Valid</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>u<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token comment">// handle error</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token operator">!</span>b <span class="token punctuation">{</span>
        <span class="token comment">// validation does not pass</span>
        <span class="token comment">// blabla...</span>
        <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token keyword">range</span> valid<span class="token punctuation">.</span>Errors <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>Key<span class="token punctuation">,</span> err<span class="token punctuation">.</span>Message<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><p>StructTag 可用的验证函数：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Required 不为空，即各个类型要求不为其零值
Min(min int) 最小值，有效类型：int，其他类型都将不能通过验证
Max(max int) 最大值，有效类型：int，其他类型都将不能通过验证
Range(min, max int) 数值的范围，有效类型：int，他类型都将不能通过验证
MinSize(min int) 最小长度，有效类型：string slice，其他类型都将不能通过验证
MaxSize(max int) 最大长度，有效类型：string slice，其他类型都将不能通过验证
Length(length int) 指定长度，有效类型：string slice，其他类型都将不能通过验证
Alpha alpha字符，有效类型：string，其他类型都将不能通过验证
Numeric 数字，有效类型：string，其他类型都将不能通过验证
AlphaNumeric alpha 字符或数字，有效类型：string，其他类型都将不能通过验证
Match(pattern string) 正则匹配，有效类型：string，其他类型都将被转成字符串再匹配(fmt.Sprintf(“%v”, obj).Match)
AlphaDash alpha 字符或数字或横杠 -_，有效类型：string，其他类型都将不能通过验证
Email 邮箱格式，有效类型：string，其他类型都将不能通过验证
IP IP 格式，目前只支持 IPv4 格式验证，有效类型：string，其他类型都将不能通过验证
Base64 base64 编码，有效类型：string，其他类型都将不能通过验证
Mobile 手机号，有效类型：string，其他类型都将不能通过验证
Tel 固定电话号，有效类型：string，其他类型都将不能通过验证
Phone 手机号或固定电话号，有效类型：string，其他类型都将不能通过验证
ZipCode 邮政编码，有效类型：string，其他类型都将不能通过验证

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="错误处理"><a href="#错误处理" class="header-anchor">#</a> 错误处理</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>this <span class="token operator">*</span>MainController<span class="token punctuation">)</span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    this<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token string">&quot;401&quot;</span><span class="token punctuation">)</span>
    v <span class="token operator">:=</span> this<span class="token punctuation">.</span><span class="token function">GetSession</span><span class="token punctuation">(</span><span class="token string">&quot;asta&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> v <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        this<span class="token punctuation">.</span><span class="token function">SetSession</span><span class="token punctuation">(</span><span class="token string">&quot;asta&quot;</span><span class="token punctuation">,</span> <span class="token function">int</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        this<span class="token punctuation">.</span>Data<span class="token punctuation">[</span><span class="token string">&quot;Email&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        this<span class="token punctuation">.</span><span class="token function">SetSession</span><span class="token punctuation">(</span><span class="token string">&quot;asta&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
        this<span class="token punctuation">.</span>Data<span class="token punctuation">[</span><span class="token string">&quot;Email&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    this<span class="token punctuation">.</span>TplName <span class="token operator">=</span> <span class="token string">&quot;index.tpl&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>这样 this.Abort(&quot;401&quot;) 之后的代码不会再执行，而且会默认显示给用户如下页面
beego 框架默认支持 401、403、404、500、503 这几种错误的处理</p> <h5 id="controller-定义-error"><a href="#controller-定义-error" class="header-anchor">#</a> Controller 定义 Error</h5> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> controllers

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;github.com/astaxie/beego&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> ErrorController <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    beego<span class="token punctuation">.</span>Controller
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>ErrorController<span class="token punctuation">)</span> <span class="token function">Error404</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    c<span class="token punctuation">.</span>Data<span class="token punctuation">[</span><span class="token string">&quot;content&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;page not found&quot;</span>
    c<span class="token punctuation">.</span>TplName <span class="token operator">=</span> <span class="token string">&quot;404.tpl&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>ErrorController<span class="token punctuation">)</span> <span class="token function">Error501</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    c<span class="token punctuation">.</span>Data<span class="token punctuation">[</span><span class="token string">&quot;content&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;server error&quot;</span>
    c<span class="token punctuation">.</span>TplName <span class="token operator">=</span> <span class="token string">&quot;501.tpl&quot;</span>
<span class="token punctuation">}</span>


<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>ErrorController<span class="token punctuation">)</span> <span class="token function">ErrorDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    c<span class="token punctuation">.</span>Data<span class="token punctuation">[</span><span class="token string">&quot;content&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;database is now down&quot;</span>
    c<span class="token punctuation">.</span>TplName <span class="token operator">=</span> <span class="token string">&quot;dberror.tpl&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>通过上面的例子我们可以看到，所有的函数都是有一定规律的，都是 Error 开头，后面的名字就是我们调用 Abort 的名字，例如 Error404 函数其实调用对应的就是 Abort(&quot;404&quot;)</p> <p>我们就只要在 beego.Run 之前采用 beego.ErrorController 注册这个错误处理函数就可以了</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token boolean">_</span> <span class="token string">&quot;btest/routers&quot;</span>
    <span class="token string">&quot;btest/controllers&quot;</span>

    <span class="token string">&quot;github.com/astaxie/beego&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    beego<span class="token punctuation">.</span><span class="token function">ErrorController</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>controllers<span class="token punctuation">.</span>ErrorController<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    beego<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/8/2021, 2:52:06 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/golang/beego2.html" class="prev">
        配置文件
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6fb23a83.js" defer></script><script src="/assets/js/2.b22280cb.js" defer></script><script src="/assets/js/47.74ec33ae.js" defer></script>
  </body>
</html>
