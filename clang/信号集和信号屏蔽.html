<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>信号阻塞 | yiluhuakai</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.775e5fee.css" as="style"><link rel="preload" href="/assets/js/app.6fb23a83.js" as="script"><link rel="preload" href="/assets/js/2.b22280cb.js" as="script"><link rel="preload" href="/assets/js/20.332c8709.js" as="script"><link rel="prefetch" href="/assets/js/10.40461a30.js"><link rel="prefetch" href="/assets/js/11.d103858e.js"><link rel="prefetch" href="/assets/js/12.4232f768.js"><link rel="prefetch" href="/assets/js/13.b3734304.js"><link rel="prefetch" href="/assets/js/14.f2386497.js"><link rel="prefetch" href="/assets/js/15.308a89ff.js"><link rel="prefetch" href="/assets/js/16.db389cec.js"><link rel="prefetch" href="/assets/js/17.cf828fcb.js"><link rel="prefetch" href="/assets/js/18.899e9438.js"><link rel="prefetch" href="/assets/js/19.580699e9.js"><link rel="prefetch" href="/assets/js/21.375795c8.js"><link rel="prefetch" href="/assets/js/22.50502a93.js"><link rel="prefetch" href="/assets/js/23.687897f9.js"><link rel="prefetch" href="/assets/js/24.ebc77e7a.js"><link rel="prefetch" href="/assets/js/25.337c6ea9.js"><link rel="prefetch" href="/assets/js/26.e762b5ea.js"><link rel="prefetch" href="/assets/js/27.13464cd3.js"><link rel="prefetch" href="/assets/js/28.523d766a.js"><link rel="prefetch" href="/assets/js/29.3987be3f.js"><link rel="prefetch" href="/assets/js/3.de1a5954.js"><link rel="prefetch" href="/assets/js/30.ff074f82.js"><link rel="prefetch" href="/assets/js/31.44d32a6e.js"><link rel="prefetch" href="/assets/js/32.b9b36b40.js"><link rel="prefetch" href="/assets/js/33.abe84780.js"><link rel="prefetch" href="/assets/js/34.2fb44918.js"><link rel="prefetch" href="/assets/js/35.a3098855.js"><link rel="prefetch" href="/assets/js/36.05c89a1c.js"><link rel="prefetch" href="/assets/js/37.27eda115.js"><link rel="prefetch" href="/assets/js/38.1dff405e.js"><link rel="prefetch" href="/assets/js/39.35c28552.js"><link rel="prefetch" href="/assets/js/4.e26bf81a.js"><link rel="prefetch" href="/assets/js/40.6405a5c2.js"><link rel="prefetch" href="/assets/js/41.34a3cdb8.js"><link rel="prefetch" href="/assets/js/42.18986dd4.js"><link rel="prefetch" href="/assets/js/43.7fdfe078.js"><link rel="prefetch" href="/assets/js/44.283ea1af.js"><link rel="prefetch" href="/assets/js/45.6778b0eb.js"><link rel="prefetch" href="/assets/js/46.c9d8e532.js"><link rel="prefetch" href="/assets/js/47.74ec33ae.js"><link rel="prefetch" href="/assets/js/48.e6419c54.js"><link rel="prefetch" href="/assets/js/49.a850af05.js"><link rel="prefetch" href="/assets/js/5.ce8ed43a.js"><link rel="prefetch" href="/assets/js/50.7a85f1c4.js"><link rel="prefetch" href="/assets/js/51.e050e509.js"><link rel="prefetch" href="/assets/js/52.4e95e579.js"><link rel="prefetch" href="/assets/js/53.2c1823d9.js"><link rel="prefetch" href="/assets/js/54.dd273805.js"><link rel="prefetch" href="/assets/js/55.ef337569.js"><link rel="prefetch" href="/assets/js/56.f0e79429.js"><link rel="prefetch" href="/assets/js/57.eab487a7.js"><link rel="prefetch" href="/assets/js/58.3060e802.js"><link rel="prefetch" href="/assets/js/59.a7db315a.js"><link rel="prefetch" href="/assets/js/6.a3856d53.js"><link rel="prefetch" href="/assets/js/60.99117954.js"><link rel="prefetch" href="/assets/js/61.805588a2.js"><link rel="prefetch" href="/assets/js/62.bb5d85a6.js"><link rel="prefetch" href="/assets/js/7.02b760da.js"><link rel="prefetch" href="/assets/js/8.78eceb25.js"><link rel="prefetch" href="/assets/js/9.196b0b91.js">
    <link rel="stylesheet" href="/assets/css/0.styles.775e5fee.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">yiluhuakai</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/leetcode/" class="nav-link">
  LeetCode
</a></div><div class="nav-item"><a href="/golang/" class="nav-link">
  Go
</a></div><div class="nav-item"><a href="/mysql/" class="nav-link">
  Mysql
</a></div><div class="nav-item"><a href="/clang/" class="nav-link router-link-active">
  C语言
</a></div><div class="nav-item"><a href="/es/" class="nav-link">
  前端
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/leetcode/" class="nav-link">
  LeetCode
</a></div><div class="nav-item"><a href="/golang/" class="nav-link">
  Go
</a></div><div class="nav-item"><a href="/mysql/" class="nav-link">
  Mysql
</a></div><div class="nav-item"><a href="/clang/" class="nav-link router-link-active">
  C语言
</a></div><div class="nav-item"><a href="/es/" class="nav-link">
  前端
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/clang/Linux命令.html" class="sidebar-link">Linux命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#位运算符-操作比特位" class="sidebar-link">位运算符（操作比特位）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#条件运算符" class="sidebar-link" style="padding-left:3rem;">条件运算符</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#比较运算符" class="sidebar-link" style="padding-left:3rem;">比较运算符</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#逻辑运算符" class="sidebar-link" style="padding-left:3rem;">逻辑运算符</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#流程控制语句" class="sidebar-link" style="padding-left:3rem;">流程控制语句</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#函数" class="sidebar-link">函数</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#递归和循环" class="sidebar-link" style="padding-left:3rem;">递归和循环</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#变量的作用域和及生命周期" class="sidebar-link">变量的作用域和及生命周期</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#局部变量" class="sidebar-link" style="padding-left:3rem;">局部变量</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#全局变量" class="sidebar-link" style="padding-left:3rem;">全局变量</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#static变量" class="sidebar-link" style="padding-left:3rem;">static变量</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#指针" class="sidebar-link">指针</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#指针的作用" class="sidebar-link" style="padding-left:3rem;">指针的作用</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#野指针" class="sidebar-link" style="padding-left:3rem;">野指针</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#不要在函数中返回一个局部变量的地址" class="sidebar-link" style="padding-left:3rem;">不要在函数中返回一个局部变量的地址</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#指针的运算" class="sidebar-link" style="padding-left:3rem;">指针的运算</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#数组名相当于一个不能移动的指针。" class="sidebar-link" style="padding-left:3rem;">数组名相当于一个不能移动的指针。</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#const关键字" class="sidebar-link">const关键字</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#数组和指针的区别" class="sidebar-link" style="padding-left:3rem;">数组和指针的区别</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#字符和字符串" class="sidebar-link">字符和字符串</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#字符串的输出" class="sidebar-link" style="padding-left:3rem;">字符串的输出</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#字符串的运算" class="sidebar-link">字符串的运算</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#copy" class="sidebar-link" style="padding-left:3rem;">copy</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#字符串的比较-strcmp" class="sidebar-link" style="padding-left:3rem;">字符串的比较（strcmp）</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#strlen-char-str-不包括-0" class="sidebar-link" style="padding-left:3rem;">strlen(char * str)，不包括'\0';</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#char-strcat-char-dest-const-char-src-将b连接在a的后面。" class="sidebar-link" style="padding-left:3rem;">char strcat(char dest, const char *src);将b连接在a的后面。</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#memset-char-a-0-20-清空字符串-使用20个0来填充。" class="sidebar-link" style="padding-left:3rem;">memset(char * a ,0,20),清空字符串，使用20个0来填充。</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#指向多个字符串" class="sidebar-link">指向多个字符串</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#main函数的函数原型" class="sidebar-link">main函数的函数原型</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#c程序的编译过程" class="sidebar-link">c程序的编译过程</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#_1-预处理" class="sidebar-link" style="padding-left:3rem;">1.预处理</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#_2-编译" class="sidebar-link" style="padding-left:3rem;">2.编译</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#_3-汇编" class="sidebar-link" style="padding-left:3rem;">3.汇编</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#_4-链接" class="sidebar-link" style="padding-left:3rem;">4.链接</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#预处理指令" class="sidebar-link">预处理指令</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#_1-头文件" class="sidebar-link" style="padding-left:3rem;">1.头文件</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#_2-宏" class="sidebar-link" style="padding-left:3rem;">2.宏</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#条件编译" class="sidebar-link">条件编译</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#内置宏变量" class="sidebar-link">内置宏变量</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#include-和-include-的区别" class="sidebar-link">#include 和 #include &quot;&quot;的区别</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#分文件调用" class="sidebar-link">分文件调用</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#static-和-extern" class="sidebar-link">static 和 extern</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#头文件的引用" class="sidebar-link">头文件的引用</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#make-和makefile" class="sidebar-link">make 和makefile</a></li></ul></li></ul></li><li><a href="/clang/结构体.html" class="sidebar-link">结构体</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/指针高级.html" class="sidebar-link">指针高级</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/stdlib标准库函数.html" class="sidebar-link">标准库函数</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/datastruct.html" class="sidebar-link">数据结构主要研究的如何使用存储区(内存)存储数字</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc1.html" class="sidebar-link">复习:uc1</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc2.html" class="sidebar-link">uc2</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc3.html" class="sidebar-link">uc3</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc4.html" class="sidebar-link">uc4</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc5.html" class="sidebar-link">uc5</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc6.html" class="sidebar-link">uc6</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc7.html" class="sidebar-link">uc7</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/计算机网络.html" class="sidebar-link">网络基础</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/计算机网络2.html" class="sidebar-link">ip地址</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/网络编程3.html" class="sidebar-link">对tcp编程的代码进行封装</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/网络编程udp.html" class="sidebar-link">udp编程模型</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/thread.html" class="sidebar-link">线程基础</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/信号集和信号屏蔽.html" class="active sidebar-link">信号阻塞</a><ul class="sidebar-sub-headers"></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h4 id="信号阻塞"><a href="#信号阻塞" class="header-anchor">#</a> 信号阻塞</h4> <p>通常我们发送一个信号给进程，当进程收到这个信号时，使用注册的信号处理函数来对信号进行处理，但是我们还可以设置进程对某些信号进行阻塞。如何设置进程对某些信号阻塞？
sigprocmask（2）
<img src="/clang/block%E2%80%94%E2%80%94mask.png" alt="f82ca643998b67c825f80e2c03af3fd6"></p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span>
<span class="token punctuation">{</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">int</span> __val<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1024</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> __sigset_t<span class="token punctuation">;</span>

<span class="token keyword">typedef</span> __sigset_t sigset_t<span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>进程对不同信号的阻塞掩码保存在sigset_t类型中，我们可以通过sigsetops(3)来查看对该类型的操作。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#include &lt;signal.h&gt;

int sigemptyset(sigset_t *set);

* 描述
initializes the signal set given by set to empty, with all signals excluded from the set.
初始化一个信号集，将信号集设置为空
* 参数
set:一个信号集的地址
* 返回值
return 0 on success and -1 on error.


int sigfillset(sigset_t *set);
* 描述
sigfillset() initializes set to full, including all signals.
* 参数
set:一个信号集的地址
* 返回值
return 0 on success and -1 on error.


int sigaddset(sigset_t *set, int signum);
* 描述
add  respectively signal signum from set.
* 参数
set:一个信号集的地址
signum:信号值
* 返回值
return 0 on success and -1 on error.


int sigdelset(sigset_t *set, int signum);
* 描述
delete  respectively signal signum from set.
* 参数
set:一个信号集的地址
signum:信号值
* 返回值
return 0 on success and -1 on error.

int sigismember(const sigset_t *set, int signum);
* 描述
tests whether signum is a member of set.
* 参数
set:一个信号集的地址
signum:信号值
* 返回值
sigismember() returns 1 if signum is a member of set, 0 if signum is not a member, and -1 on error.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><p>设置进程对某些信号阻塞，注意：9号信号不可以阻塞</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#include &lt;signal.h&gt;

/* Prototype for the glibc wrapper function */
int sigprocmask(int how, const sigset_t *set, sigset_t *oldset);

* 描述
sigprocmask()  is  used to fetch and/or change the signal mask of the calling thread.  The signal mask is the set of signals whose delivery is currently blocked for the caller
* 参数
1. how
SIG_BLOCK
The set of blocked signals is the union of the current set and the set argument.
当前的set和参数set的与运算的结果

SIG_UNBLOCK
The signals in set are removed from the current set of blocked signals.  It is permissible to attempt to unblock a signal which is not blocked.
将set集合中的信号从当前信号集中移除

SIG_SETMASK
The set of blocked signals is set to the argument set.
用参数set作为当前的阻塞掩码
2. set 
3. oldset

If oldset is non-NULL, the previous value of the signal mask is stored in oldset.
If set is NULL, then the signal mask is unchanged (i.e., how is ignored), but the current value of the signal mask is nevertheless returned in oldset (if it is not NULL).
* 返回值
sigprocmask() returns 0 on success and -1 on error.  In the event of an error, errno is set to indicate the cause.

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>代码参见:
对2号信号进行阻塞</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        sigset_t set<span class="token punctuation">;</span>

        <span class="token comment">//初始化set</span>
        <span class="token function">sigemptyset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 添加2号信号到set</span>
        <span class="token function">sigaddset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>set<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_BLOCK<span class="token punctuation">,</span><span class="token operator">&amp;</span>set<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>res <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;sigprocmask&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 对进程发送2号信号，不会有任何反映</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 设置对2号信号阻塞，这样子进程不会对2号信号处理</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="可靠信号和不可靠信号"><a href="#可靠信号和不可靠信号" class="header-anchor">#</a> 可靠信号和不可靠信号</h4> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token keyword">void</span> <span class="token function">doit</span><span class="token punctuation">(</span><span class="token keyword">int</span> sig_num<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;sig_num=%d,receive ok\n&quot;</span><span class="token punctuation">,</span>sig_num<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 设置信号处理函数</span>
        <span class="token function">signal</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>doit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">signal</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">,</span>doit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">signal</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span>doit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sigset_t set<span class="token punctuation">,</span>old_set<span class="token punctuation">;</span>
        <span class="token comment">//初始化set</span>
        <span class="token function">sigemptyset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 添加2号信号到set</span>
        <span class="token function">sigaddset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>set<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sigaddset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>set<span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//  9号信号不可以被阻塞</span>
        <span class="token function">sigaddset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>set<span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_BLOCK<span class="token punctuation">,</span><span class="token operator">&amp;</span>set<span class="token punctuation">,</span><span class="token operator">&amp;</span>old_set<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>res <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;sigprocmask&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 用原来的set来设置</span>
        res <span class="token operator">=</span> <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_SETMASK<span class="token punctuation">,</span><span class="token operator">&amp;</span>old_set<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>res <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;sigprocmask&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//解除对2，45信号的阻塞,会从未决信号中取出信号，然后执行对应的信号处理函数</span>

        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>bruce@bruce-VirtualBox:~$ <span class="token function">ps</span> aux<span class="token operator">|</span><span class="token function">grep</span> a.out 
bruce      <span class="token number">13498</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>   <span class="token number">2356</span>   <span class="token number">584</span> pts/2    S+   <span class="token number">12</span>:28   <span class="token number">0</span>:00 ./a.out
bruce      <span class="token number">13500</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>  <span class="token number">17668</span>   <span class="token number">724</span> pts/1    S+   <span class="token number">12</span>:28   <span class="token number">0</span>:00 <span class="token function">grep</span> --color<span class="token operator">=</span>auto a.out
bruce@bruce-VirtualBox:~$ <span class="token function">kill</span> -45 <span class="token number">13498</span>
bruce@bruce-VirtualBox:~$ <span class="token function">kill</span> -45 <span class="token number">13498</span>
bruce@bruce-VirtualBox:~$ <span class="token function">kill</span> -45 <span class="token number">13498</span>
bruce@bruce-VirtualBox:~$ <span class="token function">kill</span> -2 <span class="token number">13498</span>
bruce@bruce-VirtualBox:~$ <span class="token function">kill</span> -2 <span class="token number">13498</span>
bruce@bruce-VirtualBox:~$ <span class="token function">kill</span> -2 <span class="token number">13498</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>执行的结果</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>bruce@bruce-VirtualBox:~/C-/uc/net/signal$ ./a.out 
<span class="token assign-left variable">sig_num</span><span class="token operator">=</span><span class="token number">45</span>,receive ok
<span class="token assign-left variable">sig_num</span><span class="token operator">=</span><span class="token number">45</span>,receive ok
<span class="token assign-left variable">sig_num</span><span class="token operator">=</span><span class="token number">45</span>,receive ok
<span class="token assign-left variable">sig_num</span><span class="token operator">=</span><span class="token number">2</span>,receive ok
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>可以看出来，2号信号有丢失，而45号信号没有丢失，像这种发送几次最后执行几次的信号我们称之为可靠信号（34～64），而发送多次执行一次的称为不可靠信号（1~31）。</p> <h4 id="获取未决信号掩码集"><a href="#获取未决信号掩码集" class="header-anchor">#</a> 获取未决信号掩码集</h4> <p>信号未决状态：产生了信号，但是信号还没有被处理的状态。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#include &lt;signal.h&gt;

int sigpending(sigset_t *set);


* 描述
sigpending() returns the set of signals that are pending  for  delivery  to  the  calling thread (i.e., the signals which have been raised while blocked).  The mask of pending signals is returned in set.

* 参数

1.set

保存未决信号的掩码集


* 返回值

sigpending()  returns  0 on success and -1 on error.  In the event of an error, errno is set to indicate the cause.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>代码参见:pending_set.c</p> <p>要看到未决信号，需要阻塞一个信号，然后想这个进程发送信号。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token keyword">void</span> <span class="token function">doit</span><span class="token punctuation">(</span><span class="token keyword">int</span> sig_num<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;sig_num=%d,receive ok\n&quot;</span><span class="token punctuation">,</span>sig_num<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 设置信号处理函数</span>
        <span class="token function">signal</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>doit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">signal</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">,</span>doit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">signal</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span>doit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sigset_t set<span class="token punctuation">,</span>old_set<span class="token punctuation">,</span>pending_set<span class="token punctuation">;</span>
        <span class="token comment">//初始化set</span>
        <span class="token function">sigemptyset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 添加2号信号到set</span>
        <span class="token function">sigaddset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>set<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sigaddset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>set<span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//  9号信号不可以被阻塞</span>
        <span class="token function">sigaddset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>set<span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token function">sigprocmask</span><span class="token punctuation">(</span>SIG_BLOCK<span class="token punctuation">,</span><span class="token operator">&amp;</span>set<span class="token punctuation">,</span><span class="token operator">&amp;</span>old_set<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>res <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;sigprocmask&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">// 当受到被阻塞的信号后，放入未觉队列中</span>
                <span class="token comment">//  获取未决信号集</span>
                <span class="token function">sigpending</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pending_set<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// 假如发送的是2号型号，检测2号信号是不是未决信号，</span>
                <span class="token comment">// 可以判断其是不是set的成员</span>
                <span class="token keyword">int</span> r<span class="token operator">=</span> <span class="token function">sigismember</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pending_set<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>r<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;2号信号在未决队列中\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h4 id="信号从产生到处理的过程"><a href="#信号从产生到处理的过程" class="header-anchor">#</a> 信号从产生到处理的过程</h4> <p>ctrl+c发送2号信号到进程为例。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1. 从bash启动一个进程，进程运行
2. 按下ctrl+c产生一个硬件中断。
3. 进程从用户态切换到内核态，由按键驱动程序将案件解释为2号信号。记录到进程的pcb中。
4. 进程用内核态切换到用户态，发现pcb中有信号到达，调用信号处理函数，处理完毕调用sigreturn(2)返回到内核态，并清理信号处理函数的栈帧。然后重复第四部到所以的信号被处理完毕。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/8/2021, 2:52:06 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/clang/thread.html" class="prev">
        线程基础
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6fb23a83.js" defer></script><script src="/assets/js/2.b22280cb.js" defer></script><script src="/assets/js/20.332c8709.js" defer></script>
  </body>
</html>
