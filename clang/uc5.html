<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>uc5 | yiluhuakai</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.775e5fee.css" as="style"><link rel="preload" href="/assets/js/app.6fb23a83.js" as="script"><link rel="preload" href="/assets/js/2.b22280cb.js" as="script"><link rel="preload" href="/assets/js/17.cf828fcb.js" as="script"><link rel="prefetch" href="/assets/js/10.40461a30.js"><link rel="prefetch" href="/assets/js/11.d103858e.js"><link rel="prefetch" href="/assets/js/12.4232f768.js"><link rel="prefetch" href="/assets/js/13.b3734304.js"><link rel="prefetch" href="/assets/js/14.f2386497.js"><link rel="prefetch" href="/assets/js/15.308a89ff.js"><link rel="prefetch" href="/assets/js/16.db389cec.js"><link rel="prefetch" href="/assets/js/18.899e9438.js"><link rel="prefetch" href="/assets/js/19.580699e9.js"><link rel="prefetch" href="/assets/js/20.332c8709.js"><link rel="prefetch" href="/assets/js/21.375795c8.js"><link rel="prefetch" href="/assets/js/22.50502a93.js"><link rel="prefetch" href="/assets/js/23.687897f9.js"><link rel="prefetch" href="/assets/js/24.ebc77e7a.js"><link rel="prefetch" href="/assets/js/25.337c6ea9.js"><link rel="prefetch" href="/assets/js/26.e762b5ea.js"><link rel="prefetch" href="/assets/js/27.13464cd3.js"><link rel="prefetch" href="/assets/js/28.523d766a.js"><link rel="prefetch" href="/assets/js/29.3987be3f.js"><link rel="prefetch" href="/assets/js/3.de1a5954.js"><link rel="prefetch" href="/assets/js/30.ff074f82.js"><link rel="prefetch" href="/assets/js/31.44d32a6e.js"><link rel="prefetch" href="/assets/js/32.b9b36b40.js"><link rel="prefetch" href="/assets/js/33.abe84780.js"><link rel="prefetch" href="/assets/js/34.2fb44918.js"><link rel="prefetch" href="/assets/js/35.a3098855.js"><link rel="prefetch" href="/assets/js/36.05c89a1c.js"><link rel="prefetch" href="/assets/js/37.27eda115.js"><link rel="prefetch" href="/assets/js/38.1dff405e.js"><link rel="prefetch" href="/assets/js/39.35c28552.js"><link rel="prefetch" href="/assets/js/4.e26bf81a.js"><link rel="prefetch" href="/assets/js/40.6405a5c2.js"><link rel="prefetch" href="/assets/js/41.34a3cdb8.js"><link rel="prefetch" href="/assets/js/42.18986dd4.js"><link rel="prefetch" href="/assets/js/43.7fdfe078.js"><link rel="prefetch" href="/assets/js/44.283ea1af.js"><link rel="prefetch" href="/assets/js/45.6778b0eb.js"><link rel="prefetch" href="/assets/js/46.c9d8e532.js"><link rel="prefetch" href="/assets/js/47.74ec33ae.js"><link rel="prefetch" href="/assets/js/48.e6419c54.js"><link rel="prefetch" href="/assets/js/49.a850af05.js"><link rel="prefetch" href="/assets/js/5.ce8ed43a.js"><link rel="prefetch" href="/assets/js/50.7a85f1c4.js"><link rel="prefetch" href="/assets/js/51.e050e509.js"><link rel="prefetch" href="/assets/js/52.4e95e579.js"><link rel="prefetch" href="/assets/js/53.2c1823d9.js"><link rel="prefetch" href="/assets/js/54.dd273805.js"><link rel="prefetch" href="/assets/js/55.ef337569.js"><link rel="prefetch" href="/assets/js/56.f0e79429.js"><link rel="prefetch" href="/assets/js/57.eab487a7.js"><link rel="prefetch" href="/assets/js/58.3060e802.js"><link rel="prefetch" href="/assets/js/59.a7db315a.js"><link rel="prefetch" href="/assets/js/6.a3856d53.js"><link rel="prefetch" href="/assets/js/60.99117954.js"><link rel="prefetch" href="/assets/js/61.805588a2.js"><link rel="prefetch" href="/assets/js/62.bb5d85a6.js"><link rel="prefetch" href="/assets/js/7.02b760da.js"><link rel="prefetch" href="/assets/js/8.78eceb25.js"><link rel="prefetch" href="/assets/js/9.196b0b91.js">
    <link rel="stylesheet" href="/assets/css/0.styles.775e5fee.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">yiluhuakai</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/leetcode/" class="nav-link">
  LeetCode
</a></div><div class="nav-item"><a href="/golang/" class="nav-link">
  Go
</a></div><div class="nav-item"><a href="/mysql/" class="nav-link">
  Mysql
</a></div><div class="nav-item"><a href="/clang/" class="nav-link router-link-active">
  C语言
</a></div><div class="nav-item"><a href="/es/" class="nav-link">
  前端
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/leetcode/" class="nav-link">
  LeetCode
</a></div><div class="nav-item"><a href="/golang/" class="nav-link">
  Go
</a></div><div class="nav-item"><a href="/mysql/" class="nav-link">
  Mysql
</a></div><div class="nav-item"><a href="/clang/" class="nav-link router-link-active">
  C语言
</a></div><div class="nav-item"><a href="/es/" class="nav-link">
  前端
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/clang/Linux命令.html" class="sidebar-link">Linux命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#位运算符-操作比特位" class="sidebar-link">位运算符（操作比特位）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#条件运算符" class="sidebar-link" style="padding-left:3rem;">条件运算符</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#比较运算符" class="sidebar-link" style="padding-left:3rem;">比较运算符</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#逻辑运算符" class="sidebar-link" style="padding-left:3rem;">逻辑运算符</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#流程控制语句" class="sidebar-link" style="padding-left:3rem;">流程控制语句</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#函数" class="sidebar-link">函数</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#递归和循环" class="sidebar-link" style="padding-left:3rem;">递归和循环</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#变量的作用域和及生命周期" class="sidebar-link">变量的作用域和及生命周期</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#局部变量" class="sidebar-link" style="padding-left:3rem;">局部变量</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#全局变量" class="sidebar-link" style="padding-left:3rem;">全局变量</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#static变量" class="sidebar-link" style="padding-left:3rem;">static变量</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#指针" class="sidebar-link">指针</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#指针的作用" class="sidebar-link" style="padding-left:3rem;">指针的作用</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#野指针" class="sidebar-link" style="padding-left:3rem;">野指针</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#不要在函数中返回一个局部变量的地址" class="sidebar-link" style="padding-left:3rem;">不要在函数中返回一个局部变量的地址</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#指针的运算" class="sidebar-link" style="padding-left:3rem;">指针的运算</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#数组名相当于一个不能移动的指针。" class="sidebar-link" style="padding-left:3rem;">数组名相当于一个不能移动的指针。</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#const关键字" class="sidebar-link">const关键字</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#数组和指针的区别" class="sidebar-link" style="padding-left:3rem;">数组和指针的区别</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#字符和字符串" class="sidebar-link">字符和字符串</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#字符串的输出" class="sidebar-link" style="padding-left:3rem;">字符串的输出</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#字符串的运算" class="sidebar-link">字符串的运算</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#copy" class="sidebar-link" style="padding-left:3rem;">copy</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#字符串的比较-strcmp" class="sidebar-link" style="padding-left:3rem;">字符串的比较（strcmp）</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#strlen-char-str-不包括-0" class="sidebar-link" style="padding-left:3rem;">strlen(char * str)，不包括'\0';</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#char-strcat-char-dest-const-char-src-将b连接在a的后面。" class="sidebar-link" style="padding-left:3rem;">char strcat(char dest, const char *src);将b连接在a的后面。</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#memset-char-a-0-20-清空字符串-使用20个0来填充。" class="sidebar-link" style="padding-left:3rem;">memset(char * a ,0,20),清空字符串，使用20个0来填充。</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#指向多个字符串" class="sidebar-link">指向多个字符串</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#main函数的函数原型" class="sidebar-link">main函数的函数原型</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#c程序的编译过程" class="sidebar-link">c程序的编译过程</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#_1-预处理" class="sidebar-link" style="padding-left:3rem;">1.预处理</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#_2-编译" class="sidebar-link" style="padding-left:3rem;">2.编译</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#_3-汇编" class="sidebar-link" style="padding-left:3rem;">3.汇编</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#_4-链接" class="sidebar-link" style="padding-left:3rem;">4.链接</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#预处理指令" class="sidebar-link">预处理指令</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#_1-头文件" class="sidebar-link" style="padding-left:3rem;">1.头文件</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#_2-宏" class="sidebar-link" style="padding-left:3rem;">2.宏</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#条件编译" class="sidebar-link">条件编译</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#内置宏变量" class="sidebar-link">内置宏变量</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#include-和-include-的区别" class="sidebar-link">#include 和 #include &quot;&quot;的区别</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#分文件调用" class="sidebar-link">分文件调用</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#static-和-extern" class="sidebar-link">static 和 extern</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#头文件的引用" class="sidebar-link">头文件的引用</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#make-和makefile" class="sidebar-link">make 和makefile</a></li></ul></li></ul></li><li><a href="/clang/结构体.html" class="sidebar-link">结构体</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/指针高级.html" class="sidebar-link">指针高级</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/stdlib标准库函数.html" class="sidebar-link">标准库函数</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/datastruct.html" class="sidebar-link">数据结构主要研究的如何使用存储区(内存)存储数字</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc1.html" class="sidebar-link">复习:uc1</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc2.html" class="sidebar-link">uc2</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc3.html" class="sidebar-link">uc3</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc4.html" class="sidebar-link">uc4</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc5.html" aria-current="page" class="active sidebar-link">uc5</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc6.html" class="sidebar-link">uc6</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc7.html" class="sidebar-link">uc7</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/计算机网络.html" class="sidebar-link">网络基础</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/计算机网络2.html" class="sidebar-link">ip地址</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/网络编程3.html" class="sidebar-link">对tcp编程的代码进行封装</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/网络编程udp.html" class="sidebar-link">udp编程模型</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/thread.html" class="sidebar-link">线程基础</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/信号集和信号屏蔽.html" class="sidebar-link">信号阻塞</a><ul class="sidebar-sub-headers"></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="uc5"><a href="#uc5" class="header-anchor">#</a> uc5</h3> <h4 id="进程的终止"><a href="#进程的终止" class="header-anchor">#</a> 进程的终止</h4> <p>1.return 调用从当前函数返回，结束函数的执行，main函数调用，当前进程并没有退出。main函数返回的值可以用echo $?在shell中查看。</p> <p>2.exit(3)函数</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> #include &lt;stdlib.h&gt;

 void exit(int status);

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><p>描述
The exit() function causes normal process termination and the value of status &amp; 0xFF is returned to the parent。</p></li> <li><p>参数status</p></li></ul> <p>status和&amp; 0xFF的结果被传递给父进程bash.可以通过echo $?查看。
$? 是一个特殊变量，用来获取上一个命令的退出状态，或者上一个函数的返回值。</p> <p>当status是一个负数时，它在计算机中以补码的形式存在。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>-1   1000 ... 0000  0001
     1111    1111  1110
     1111    1111  1111
oxFF         1111  1111 
~           1111 1111 -&gt;255              
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>当exit(-1)返回255。</p> <p>使用pstree查看当前进程的父进程。</p> <p>在代码中加入getchar(),让当前进程不退出。然后新打开一个shell终端，执行pstree命令。pstree user可以查看当前用户打开的进程。</p> <h4 id="遗言函数"><a href="#遗言函数" class="header-anchor">#</a> 遗言函数</h4> <p>遗言函数就时进程终止的时候调用的函数。需要在当前进程中注册遗言函数。</p> <p>1.遗言函数注册atexit(3)</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#include &lt;stdlib.h&gt;

int atexit(void (*function)(void));

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><p>描述
The atexit() function registers the given function to be called at normal process termination, either via exit(3) or via return from the pro‐gram's main()。</p></li> <li><p>参数
function时一个函数指针，指向遗言函数的入口地址。</p></li> <li><p>返回值
成功返回0，失败返回一个非零的值。</p></li> <li><p>注意事项</p></li></ul> <ol><li>遗言函数的执行顺序是注册的反序。</li> <li>注册多个相同的遗言函数，每注册一次调用一次。</li> <li>当调用fork创建一个子进程，子进程会继承父进程的遗言函数。当子进程调用exec函数，所有的遗言函数被移除。</li></ol> <p>2.遗言函数的注册on_exit(3)</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#include &lt;stdlib.h&gt;
int on_exit(void (*function)(int , void *), void *arg);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><p>描述
The on_exit() function registers the given function  to  be  called  at normal  process termination, whether via exit(3) or via return from the program's main().  The function is passed the status argument given  to the last call to exit(3) and the arg argument from on_exit().</p></li> <li><p>参数
function 遗言函数指针
arg 传递给遗言函数的第二个参数</p></li> <li><p>返回值
成功返回0，失败返回一个非零的值。</p></li></ul> <p>代码参见uc/thread/on_exit.c</p> <h4 id="进程资源回收"><a href="#进程资源回收" class="header-anchor">#</a> 进程资源回收</h4> <p>进程终止的时候，需要对其占用的计算机资源回收。</p> <p>父进程负责回收子进程的资源。</p> <p>回收子进程占用的资源</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#include &lt;sys/types.h&gt;
#include &lt;sys/wait.h&gt;

pid_t wait(int *wstatus);

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><p>描述
等待子进程状态改变，当进程状态改变时回收子进程所占用的资源。如果子进程没有wait函数，会变成僵尸状态。</p> <p>All  of  these  system  calls  are used to wait for state changes in a child of the calling process, and obtain information about  the  child
whose  state  has  changed. <u>A  state change is considered to be: the child terminated; the child was stopped by a signal; or the child  was resumed  by a signal.</u>  In the case of a terminated child, performing a wait allows the system to release the resources  associated  with  the child;  if  a wait is not performed, then the terminated child remains in a &quot;zombie&quot; state (see NOTES below).</p></li> <li><p>参数
wstatus 子进程改变后的状态，
If  wstatus is not NULL, wait() and waitpid() store status information in the int to which it points.</p></li> <li><p>返回值
on success, returns the process ID of the terminated child; on error, -1 is returned.</p></li></ul> <p>通过下面的宏可以检查返回值的status.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>WIFEXITED(wstatus)
returns true if the child  terminated  normally,  that  is,  by calling exit(3) or _exit(2), or by returning from main().

WEXITSTATUS(wstatus)
returns  the  exit  status  of the child.  This consists of the least significant 8 bits of the status argument that the  child specified  in  a call to exit(3) or _exit(2) or as the argument
for a return statement in main().  This  macro  should  be  em‐ployed only if WIFEXITED returned true.

WIFSIGNALED(wstatus)
returns true if the child process was terminated by a signal.

WTERMSIG(wstatus)
returns  the number of the signal that caused the child process to terminate.  This macro should be employed  only  if  WIFSIG‐NALED returned true.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="想进程发送一个中断信号"><a href="#想进程发送一个中断信号" class="header-anchor">#</a> 想进程发送一个中断信号</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">kill</span> -2<span class="token operator">|</span><span class="token number">3</span><span class="token operator">|</span><span class="token number">5</span> pid
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="僵尸进程-zombie"><a href="#僵尸进程-zombie" class="header-anchor">#</a> 僵尸进程（zombie）</h4> <p>子进程终止时父进程没有回收子进程占用的资源，这时候子进程处于僵尸状态。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/wait.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token keyword">int</span>  <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//  创建一个子进程</span>
        <span class="token keyword">int</span> s<span class="token punctuation">;</span>
        pid_t  pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span> pid <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;fork&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> pid <span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;child process....%d\n&quot;</span><span class="token punctuation">,</span><span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// getchar();</span>

                <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token comment">// 等待子进程终止</span>
                <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">wait</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;parent process.....\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">WIFEXITED</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;normal terminal,status = %d\n&quot;</span><span class="token punctuation">,</span><span class="token function">WEXITSTATUS</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">WIFSGNALED</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;signal terminal,signal number =%d\n&quot;</span><span class="token punctuation">,</span><span class="token function">WTERMSIG</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>首先编译后执行a.out.子进程已经终止，父进程等待用户输入，此时子进程处于僵尸状态。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">ps</span> aux<span class="token operator">|</span><span class="token function">grep</span> a.out
bruce      <span class="token number">24318</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>   <span class="token number">2488</span>   <span class="token number">588</span> pts/1    S+   <span class="token number">21</span>:39   <span class="token number">0</span>:00 ./a.out
bruce      <span class="token number">24319</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>      <span class="token number">0</span>     <span class="token number">0</span> pts/1    Z+   <span class="token number">21</span>:39   <span class="token number">0</span>:00 <span class="token punctuation">[</span>a.out<span class="token punctuation">]</span> <span class="token operator">&lt;</span>defunct<span class="token operator">&gt;</span>
bruce      <span class="token number">24321</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>  <span class="token number">17680</span>   <span class="token number">740</span> pts/0    S+   <span class="token number">21</span>:40   <span class="token number">0</span>:00 <span class="token function">grep</span> --color<span class="token operator">=</span>auto a.out

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>S+ === sleep. Z+ ===zombie</p> <p>然后在控制台输入字符串，父进程wait()函数去回收子进程资源,然后父进程睡眠10秒。查看进程的状态。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">ps</span> aux<span class="token operator">|</span><span class="token function">grep</span> a.out
bruce      <span class="token number">24318</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>   <span class="token number">2488</span>   <span class="token number">588</span> pts/1    S+   <span class="token number">21</span>:39   <span class="token number">0</span>:00 ./a.out
bruce      <span class="token number">24399</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>  <span class="token number">17680</span>   <span class="token number">736</span> pts/0    S+   <span class="token number">21</span>:46   <span class="token number">0</span>:00 <span class="token function">grep</span> --color<span class="token operator">=</span>auto a.out
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>10秒后，父进程被回收（bash）</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">ps</span> aux<span class="token operator">|</span><span class="token function">grep</span> a.out
bruce      <span class="token number">24425</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>  <span class="token number">17680</span>   <span class="token number">736</span> pts/0    S+   <span class="token number">21</span>:48   <span class="token number">0</span>:00 <span class="token function">grep</span> --color<span class="token operator">=</span>auto a.out
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="孤儿进程-orphan"><a href="#孤儿进程-orphan" class="header-anchor">#</a> 孤儿进程（orphan）</h4> <p>孤儿进程指的是父进程已经终止了，子进程还没终止，这时候子进程会过继给1号进程。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/wait.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token keyword">int</span>  <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//  创建一个子进程</span>
        <span class="token keyword">int</span> s<span class="token punctuation">;</span>
        pid_t  pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span> pid <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;fork&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> pid <span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;child process....%d\n&quot;</span><span class="token punctuation">,</span><span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;parent process....%d\n&quot;</span><span class="token punctuation">,</span><span class="token function">getppid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;parent process....%d\n&quot;</span><span class="token punctuation">,</span><span class="token function">getppid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token comment">// 等待子进程终止</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;parent sleep has died\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>bruce@bruce-VirtualBox:~/C-/uc/thread$ ./a.out 
parent <span class="token function">sleep</span> has died
child process<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token number">24765</span>
parent process<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token number">24764</span>
bruce@bruce-VirtualBox:~/C-/uc/thread$ parent process<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token number">1349</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ubuntu高版本是过继给了1349号进程。</p> <h4 id="waitpid-2"><a href="#waitpid-2" class="header-anchor">#</a> waitpid(2)</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>#include &lt;sys/types.h&gt;
#include &lt;sys/wait.h&gt;

pid_t wait(int *wstatus);
pid_t waitpid(pid_t pid, int *wstatus, int options);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><p>描述
等待指定pid的子进程终止。</p></li> <li><p>参数</p></li></ul> <p>1.pid</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt; -1   meaning  wait  for  any  child process whose process group ID is equal to the absolute value of pid.

-1     meaning wait for any child process.

0      meaning wait for any child process whose  process  group  ID  is equal  to that of the calling process at the time of the call to waitpid().

&gt; 0    meaning wait for the child whose process  ID  is  equal  to  the value of pid.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>父进程和子进程组属于同一个进程组。</p> <ol start="2"><li>wstatus</li></ol> <p>保存子进程传过来的状态</p> <ol start="3"><li>option</li></ol> <p>The  value  of  options  is an OR of zero or more of the following con‐stants:</p> <p>0 阻塞知道子进程退出</p> <p>WNOHANG     return immediately if no child has exited.</p> <p>。。。。其他的不掌握</p> <p>so waitpid(-1,&amp;s,0) === wait(&amp;s)</p> <ul><li>返回值</li></ul> <p>on success, returns the process ID of the child whose state has changed; if WNOHANG was specified and one or more child(ren) specified by pid ex‐
ist, but have not yet changed state, then 0 is returned.  On error, -1 is returned.</p> <p>成功返回子进程的pid,如果非阻塞且没有子进程退出，返回0；失败了返回-1.</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/8/2021, 2:52:06 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/clang/uc4.html" class="prev">
        uc4
      </a></span> <span class="next"><a href="/clang/uc6.html">
        uc6
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6fb23a83.js" defer></script><script src="/assets/js/2.b22280cb.js" defer></script><script src="/assets/js/17.cf828fcb.js" defer></script>
  </body>
</html>
