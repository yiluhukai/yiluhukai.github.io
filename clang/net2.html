<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ip地址 | yiluhuakai</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.992cb7aa.css" as="style"><link rel="preload" href="/assets/js/app.9b56a05a.js" as="script"><link rel="preload" href="/assets/js/2.b22280cb.js" as="script"><link rel="preload" href="/assets/js/13.6add00c5.js" as="script"><link rel="prefetch" href="/assets/js/10.413ab2ab.js"><link rel="prefetch" href="/assets/js/100.2d785741.js"><link rel="prefetch" href="/assets/js/101.a9fd3349.js"><link rel="prefetch" href="/assets/js/11.99f54ddd.js"><link rel="prefetch" href="/assets/js/12.c46f64f3.js"><link rel="prefetch" href="/assets/js/14.40115781.js"><link rel="prefetch" href="/assets/js/15.c3827c6c.js"><link rel="prefetch" href="/assets/js/16.304d275d.js"><link rel="prefetch" href="/assets/js/17.006e2fe4.js"><link rel="prefetch" href="/assets/js/18.7f93828f.js"><link rel="prefetch" href="/assets/js/19.a72c6116.js"><link rel="prefetch" href="/assets/js/20.d175ff74.js"><link rel="prefetch" href="/assets/js/21.7092a034.js"><link rel="prefetch" href="/assets/js/22.1419ba41.js"><link rel="prefetch" href="/assets/js/23.ce5e3c1b.js"><link rel="prefetch" href="/assets/js/24.9f9edaa3.js"><link rel="prefetch" href="/assets/js/25.a57ae5dc.js"><link rel="prefetch" href="/assets/js/26.5ba697f1.js"><link rel="prefetch" href="/assets/js/27.9ecaa5dc.js"><link rel="prefetch" href="/assets/js/28.290c65fe.js"><link rel="prefetch" href="/assets/js/29.bdbc3eeb.js"><link rel="prefetch" href="/assets/js/3.ac44586b.js"><link rel="prefetch" href="/assets/js/30.6f37d998.js"><link rel="prefetch" href="/assets/js/31.b1ac1238.js"><link rel="prefetch" href="/assets/js/32.024f8182.js"><link rel="prefetch" href="/assets/js/33.202e11b5.js"><link rel="prefetch" href="/assets/js/34.e755ffc0.js"><link rel="prefetch" href="/assets/js/35.376b8f63.js"><link rel="prefetch" href="/assets/js/36.56735f24.js"><link rel="prefetch" href="/assets/js/37.b7d03c63.js"><link rel="prefetch" href="/assets/js/38.d9407e30.js"><link rel="prefetch" href="/assets/js/39.4f87e45d.js"><link rel="prefetch" href="/assets/js/4.a4a037c8.js"><link rel="prefetch" href="/assets/js/40.5a53ee48.js"><link rel="prefetch" href="/assets/js/41.f7fa6a68.js"><link rel="prefetch" href="/assets/js/42.3c07d4ad.js"><link rel="prefetch" href="/assets/js/43.2965402d.js"><link rel="prefetch" href="/assets/js/44.fef5da48.js"><link rel="prefetch" href="/assets/js/45.ff058ba7.js"><link rel="prefetch" href="/assets/js/46.5a74f2cd.js"><link rel="prefetch" href="/assets/js/47.5931bb97.js"><link rel="prefetch" href="/assets/js/48.cbf85ab3.js"><link rel="prefetch" href="/assets/js/49.0319f8e4.js"><link rel="prefetch" href="/assets/js/5.d0d45788.js"><link rel="prefetch" href="/assets/js/50.497cb73f.js"><link rel="prefetch" href="/assets/js/51.4b6e5c5b.js"><link rel="prefetch" href="/assets/js/52.f4edf34f.js"><link rel="prefetch" href="/assets/js/53.df9c0557.js"><link rel="prefetch" href="/assets/js/54.1654be3b.js"><link rel="prefetch" href="/assets/js/55.c9e37e1f.js"><link rel="prefetch" href="/assets/js/56.052c5808.js"><link rel="prefetch" href="/assets/js/57.cf8cebef.js"><link rel="prefetch" href="/assets/js/58.220252cd.js"><link rel="prefetch" href="/assets/js/59.7e76271a.js"><link rel="prefetch" href="/assets/js/6.b5583d51.js"><link rel="prefetch" href="/assets/js/60.38c88311.js"><link rel="prefetch" href="/assets/js/61.c4b0da1c.js"><link rel="prefetch" href="/assets/js/62.d8be952c.js"><link rel="prefetch" href="/assets/js/63.19c02fd0.js"><link rel="prefetch" href="/assets/js/64.9d51d342.js"><link rel="prefetch" href="/assets/js/65.31c63e7c.js"><link rel="prefetch" href="/assets/js/66.badcb6df.js"><link rel="prefetch" href="/assets/js/67.83764c63.js"><link rel="prefetch" href="/assets/js/68.152c45b6.js"><link rel="prefetch" href="/assets/js/69.2119cafb.js"><link rel="prefetch" href="/assets/js/7.d21b1042.js"><link rel="prefetch" href="/assets/js/70.ff7211f3.js"><link rel="prefetch" href="/assets/js/71.26e7783e.js"><link rel="prefetch" href="/assets/js/72.dc5a3ba6.js"><link rel="prefetch" href="/assets/js/73.d8356ad1.js"><link rel="prefetch" href="/assets/js/74.10184aff.js"><link rel="prefetch" href="/assets/js/75.716811ca.js"><link rel="prefetch" href="/assets/js/76.046e6155.js"><link rel="prefetch" href="/assets/js/77.d287e80f.js"><link rel="prefetch" href="/assets/js/78.635ed9d3.js"><link rel="prefetch" href="/assets/js/79.4485123f.js"><link rel="prefetch" href="/assets/js/8.8bd3dfa9.js"><link rel="prefetch" href="/assets/js/80.74fc122c.js"><link rel="prefetch" href="/assets/js/81.cb3ce31c.js"><link rel="prefetch" href="/assets/js/82.bf81591e.js"><link rel="prefetch" href="/assets/js/83.01b0002d.js"><link rel="prefetch" href="/assets/js/84.6af4ae46.js"><link rel="prefetch" href="/assets/js/85.31122a7c.js"><link rel="prefetch" href="/assets/js/86.7641b1ab.js"><link rel="prefetch" href="/assets/js/87.63912fdd.js"><link rel="prefetch" href="/assets/js/88.01d6d061.js"><link rel="prefetch" href="/assets/js/89.ec494ad7.js"><link rel="prefetch" href="/assets/js/9.17f8341c.js"><link rel="prefetch" href="/assets/js/90.a2905192.js"><link rel="prefetch" href="/assets/js/91.5b1b5e00.js"><link rel="prefetch" href="/assets/js/92.f8112523.js"><link rel="prefetch" href="/assets/js/93.8e9fd5a8.js"><link rel="prefetch" href="/assets/js/94.41217af6.js"><link rel="prefetch" href="/assets/js/95.b253d44f.js"><link rel="prefetch" href="/assets/js/96.76495ed0.js"><link rel="prefetch" href="/assets/js/97.9f48729e.js"><link rel="prefetch" href="/assets/js/98.0e36c4a8.js"><link rel="prefetch" href="/assets/js/99.5b6ab9af.js">
    <link rel="stylesheet" href="/assets/css/0.styles.992cb7aa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">yiluhuakai</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/leetcode/" class="nav-link">
  LeetCode
</a></div><div class="nav-item"><a href="/golang/" class="nav-link">
  Go
</a></div><div class="nav-item"><a href="/mysql/" class="nav-link">
  Mysql
</a></div><div class="nav-item"><a href="/clang/" class="nav-link router-link-active">
  C语言
</a></div><div class="nav-item"><a href="/es/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/nodejs/" class="nav-link">
  nodejs
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/java/" class="nav-link">
  Java
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/leetcode/" class="nav-link">
  LeetCode
</a></div><div class="nav-item"><a href="/golang/" class="nav-link">
  Go
</a></div><div class="nav-item"><a href="/mysql/" class="nav-link">
  Mysql
</a></div><div class="nav-item"><a href="/clang/" class="nav-link router-link-active">
  C语言
</a></div><div class="nav-item"><a href="/es/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/nodejs/" class="nav-link">
  nodejs
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/java/" class="nav-link">
  Java
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/clang/linux.html" class="sidebar-link">Linux命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/clang/linux.html#位运算符-操作比特位" class="sidebar-link">位运算符（操作比特位）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/clang/linux.html#条件运算符" class="sidebar-link" style="padding-left:3rem;">条件运算符</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#比较运算符" class="sidebar-link" style="padding-left:3rem;">比较运算符</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#逻辑运算符" class="sidebar-link" style="padding-left:3rem;">逻辑运算符</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#流程控制语句" class="sidebar-link" style="padding-left:3rem;">流程控制语句</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#函数" class="sidebar-link">函数</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#递归和循环" class="sidebar-link" style="padding-left:3rem;">递归和循环</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#变量的作用域和及生命周期" class="sidebar-link">变量的作用域和及生命周期</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#局部变量" class="sidebar-link" style="padding-left:3rem;">局部变量</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#全局变量" class="sidebar-link" style="padding-left:3rem;">全局变量</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#static变量" class="sidebar-link" style="padding-left:3rem;">static变量</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#指针" class="sidebar-link">指针</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#指针的作用" class="sidebar-link" style="padding-left:3rem;">指针的作用</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#野指针" class="sidebar-link" style="padding-left:3rem;">野指针</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#不要在函数中返回一个局部变量的地址" class="sidebar-link" style="padding-left:3rem;">不要在函数中返回一个局部变量的地址</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#指针的运算" class="sidebar-link" style="padding-left:3rem;">指针的运算</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#数组名相当于一个不能移动的指针。" class="sidebar-link" style="padding-left:3rem;">数组名相当于一个不能移动的指针。</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#const关键字" class="sidebar-link">const关键字</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#数组和指针的区别" class="sidebar-link" style="padding-left:3rem;">数组和指针的区别</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#字符和字符串" class="sidebar-link">字符和字符串</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#字符串的输出" class="sidebar-link" style="padding-left:3rem;">字符串的输出</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#字符串的运算" class="sidebar-link">字符串的运算</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#copy" class="sidebar-link" style="padding-left:3rem;">copy</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#字符串的比较-strcmp" class="sidebar-link" style="padding-left:3rem;">字符串的比较（strcmp）</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#strlen-char-str-不包括-0" class="sidebar-link" style="padding-left:3rem;">strlen(char * str)，不包括'\0';</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#char-strcat-char-dest-const-char-src-将b连接在a的后面。" class="sidebar-link" style="padding-left:3rem;">char strcat(char dest, const char *src);将b连接在a的后面。</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#memset-char-a-0-20-清空字符串-使用20个0来填充。" class="sidebar-link" style="padding-left:3rem;">memset(char * a ,0,20),清空字符串，使用20个0来填充。</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#指向多个字符串" class="sidebar-link">指向多个字符串</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#main函数的函数原型" class="sidebar-link">main函数的函数原型</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#c程序的编译过程" class="sidebar-link">c程序的编译过程</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#_1-预处理" class="sidebar-link" style="padding-left:3rem;">1.预处理</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#_2-编译" class="sidebar-link" style="padding-left:3rem;">2.编译</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#_3-汇编" class="sidebar-link" style="padding-left:3rem;">3.汇编</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#_4-链接" class="sidebar-link" style="padding-left:3rem;">4.链接</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#预处理指令" class="sidebar-link">预处理指令</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#_1-头文件" class="sidebar-link" style="padding-left:3rem;">1.头文件</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#_2-宏" class="sidebar-link" style="padding-left:3rem;">2.宏</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#条件编译" class="sidebar-link">条件编译</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#内置宏变量" class="sidebar-link">内置宏变量</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#include-和-include-的区别" class="sidebar-link">#include 和 #include &quot;&quot;的区别</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#分文件调用" class="sidebar-link">分文件调用</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#static-和-extern" class="sidebar-link">static 和 extern</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#头文件的引用" class="sidebar-link">头文件的引用</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#make-和makefile" class="sidebar-link">make 和makefile</a></li></ul></li></ul></li><li><a href="/clang/struct.html" class="sidebar-link">结构体</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/point.html" class="sidebar-link">指针高级</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/stdlib.html" class="sidebar-link">标准库函数</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/datastruct.html" class="sidebar-link">数据结构主要研究的如何使用存储区(内存)存储数字</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc1.html" class="sidebar-link">复习:uc1</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc2.html" class="sidebar-link">uc2</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc3.html" class="sidebar-link">uc3</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc4.html" class="sidebar-link">uc4</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc5.html" class="sidebar-link">uc5</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc6.html" class="sidebar-link">uc6</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc7.html" class="sidebar-link">uc7</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/net1.html" class="sidebar-link">网络基础</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/net2.html" aria-current="page" class="active sidebar-link">ip地址</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/net3.html" class="sidebar-link">对tcp编程的代码进行封装</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/net-udp.html" class="sidebar-link">udp编程模型</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/thread.html" class="sidebar-link">线程基础</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/signal.html" class="sidebar-link">信号阻塞</a><ul class="sidebar-sub-headers"></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h4 id="ip地址"><a href="#ip地址" class="header-anchor">#</a> ip地址</h4> <p>ipv4和ipv6
ipv4四个字节，ipv6是16个字节。</p> <p>IP地址由两部分组成，网络号和主机号，</p> <p>192.168.1.111</p> <p>获取这个网络号需要子网掩码，假设子网掩码是255.255.255.0</p> <p>那么网络号就是 192.168.1.111&amp;255.255.255.0 =&gt;192.168.1.0</p> <p>所以这个网断可以分配256个地址，但是192.168.1.0代表网络号，192.168.1.255代表广播地址。所以可以有254个主机。</p> <p><img src="/clang/IP%E5%9C%B0%E5%9D%80%E5%88%86%E7%B1%BB.png" alt="1c8ae77417419ab5e51ed3a0cf26c49b"></p> <h4 id="集线器、交换机、路由器"><a href="#集线器、交换机、路由器" class="header-anchor">#</a> 集线器、交换机、路由器</h4> <p><img src="/clang/533E9C55-6835-4F13-AC18-22021D580DAA.png" alt="55c821c4381fa869a784d2242e72606e"></p> <p>集线器hub, 对电信号进行放大分流，物理层。收到信号后在将信号会将信号广播到链接这个集线器的所有电脑上，同时只能有一个电脑在通信。
<img src="/clang/6E946E56-D3C0-45F6-9BD5-A39813E97156.png" alt="b656de2331a5d821d7cbdddc51bb00d4"></p> <p>交换机： 局域网中不同的主机间通信需要通过交换机。它传输的是以太网帧。工作在数据链路层。收到信号后将信号发给指定mac地址的网卡。</p> <p>路由器： 不同的网络之间交换数据，需要通过路由器。他转发的是ip数据报。工作在网络层。</p> <p><img src="/clang/3B65AE32-8668-409C-BE16-F71064952A2F.png" alt="b8bced8a4d6d1ee9c0759b713be7316b"></p> <h4 id="局域网之间的数据传输"><a href="#局域网之间的数据传输" class="header-anchor">#</a> 局域网之间的数据传输</h4> <p><img src="/clang/6E946E56-D3C0-45F6-9BD5-A39813E97156.png" alt="b656de2331a5d821d7cbdddc51bb00d4"></p> <p>比如小A和小E在一个局域网中，小A给小E发送数据，小A通过查询自己路由表发现两人在同一网段。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> route
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后查看自己的arp表，查找目标ip地址mac地址</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>
<span class="token function">sudo</span> arp -a
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>当在arp表中找不到目标ip地址对应的ma地址，会在局域网中发起广播，目标ip地址的收到广播后会把自己的mac地址发送源ip地址，</p> <p>然后源目标ip地址在链路层的以太网帧中填入目标mac地址，发送给出去。</p> <h4 id="跨网段数据传输"><a href="#跨网段数据传输" class="header-anchor">#</a> 跨网段数据传输</h4> <p>ip数据包会先发给网关(和主机相连的路由器的ip地址)，网关将ip数据报的报文发送给目标主机的网关，有网关交给目标主机。</p> <h4 id="基于tcp的编程"><a href="#基于tcp的编程" class="header-anchor">#</a> 基于tcp的编程</h4> <p>TCP/UDP位于传输层，
TCP 基于连接的可靠的数据传输，双向的基于流的。
UDP 基于数据包的， 不可靠的，但是比较高效。</p> <p>连接的建立：通过三次握手建立,客户端：connect(2),服务器端：accept(2)</p> <p><img src="/clang/%E8%BF%9E%E6%8E%A5%E7%9A%84%E5%BB%BA%E7%AB%8B.png" alt="66a81556bb623f394846ad298e74ae63"> <img src="/clang/%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.png" alt="fca3d413ed842449ffdf2348f515e010"></p> <p>链接断开：四次分手</p> <p>tcp编程模型
<img src="/clang/tcp%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%9E%8B.png" alt="4b9a0fdebb0435fbbeda954b066d45a9"></p> <p>服务器端：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1. 创建一个用于通信的socket设备，返回socket的文件描述符。sfd
socket(2)
2. 绑定sfd和服务器的地址和端口绑定 bind(2)
3. 将服务器设置为被动连接模式，等待客户端连接的到来，连接到来时，将连接放入未决连接的队列中。未决连接指的是发送到服务器但是还没有处理的连接。listen(2)
while(1){
    4.从未决队列中取出一个连接，返回一个和客户端连接的文件描述符cfd,取不出来处于阻塞状态。accept(2)
    5.使用cfd读取客户端的请求 read(2)
    6.处理客户端的请求
    7.将处理结果返回给客户端 write(2)
    8.关闭cfd. close(2)
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>客户端</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1.建立用于通讯的socket设置，返回文件描述符， sfd
socket(2)
2. 使用sfd连接服务器端，
connect(2)
3. 向服务器端发送数据
write(2)
4. 等待服务器端返回数据

5. 处理服务器返回的数据
read(2)
6. 告知服务器，关闭客户端的连接
close(2)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ol><li>socket(2)</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>#include &lt;sys/types.h&gt;          /* See NOTES */
#include &lt;sys/socket.h&gt;

int socket(int domain, int type, int protocol);

* 描述
socket()  creates  an endpoint for communication and returns a file descriptor that refers to that endpoint.  The file descriptor returned by a  successful call will be the lowest-numbered file descriptor not currently open for the process.

* 参数
1. domain：The domain argument specifies a communication domain; this selects  the
protocol  family  which will be used for communication. 

AF_INET      IPv4 Internet protocols
AF_INET6     IPv6 Internet protocols 
2. type
SOCK_STREAM    其实就是tcp 
Provides sequenced, reliable, two-way, connection-based byte  streams.  An out-of-band data transmission mechanism may be supported.

SOCK_DGRAM    其实就是udp 
Supports datagrams (connectionless, unreliable messages of a fixed maximum length).

protocol:The  protocol  specifies  a  particular  protocol  to  be used with the
socket.  Normally only a single protocol exists to support a particular
socket  type within a given protocol family, in which case protocol can
be specified as 0.

* 返回值

成功返回文件描述符，失败返回-1， errno设置。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><ol start="2"><li>bind(2)</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>#include &lt;sys/types.h&gt;          /* See NOTES */
#include &lt;sys/socket.h&gt;

int bind(int sockfd, const struct sockaddr *addr,socklen_t addrlen);

* 描述

When a socket is created with socket(2), it exists in a name space (address family) but has no address assigned to it.   bind()  assigns  the address  specified  by  addr  to the socket referred to by the file descriptor sockfd.  addrlen specifies the size, in bytes, of the  address structure  pointed to by addr.

* 参数
1.sockfd 通过socket(2)创建的文件描述符

2.addr 
The  actual  structure  passed for the addr argument will depend on the address family.
address family ： ipv4 、ipv6
struct sockaddr {
               sa_family_t sa_family;
               char        sa_data[14];
}

3. addrlen  指向的结构体的大小。

* 返回值

成功返回0，失败返回-1，errno被设置。

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><ol start="3"><li>listen(2)</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>#include &lt;sys/types.h&gt;          /* See NOTES */
#include &lt;sys/socket.h&gt;

int listen(int sockfd, int backlog);


* 描述
listen()  marks  the  socket referred to by sockfd as a passive socket,
that is, as a socket that will be used to  accept  incoming  connection
requests using accept(2).

* 参数
1. The  sockfd  argument  is  a file descriptor that refers to a socket of type SOCK_STREAM or SOCK_SEQPACKET.

socket 是一个有连接的socket.

2. backlog

The backlog argument defines the maximum length to which the  queue  of pending  connections  for sockfd may grow. If a connection request arrives when the queue is full, the client may receive an error  with  an indication  of ECONNREFUSED or, if the underlying protocol supports retransmission, the request may be ignored so that a later  reattempt  at connection succeeds.

未决连接的最大值。根据底层协议不同客户端可能收到错误或者这个请求被忽略。

* 返回值
成功返回0，失败返回-1，errno被设置。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><ol start="4"><li>accept(2)</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>#include &lt;sys/types.h&gt;          /* See NOTES */
#include &lt;sys/socket.h&gt;

int accept(int sockfd, struct sockaddr *addr, socklen_t *addrlen);

* 描述
The  accept()  system  call  is used with connection-based socket types (SOCK_STREAM, SOCK_SEQPACKET).  It extracts the  first  connection  request  on  the  queue  of pending connections for the listening socket,sockfd, creates a new connected socket, and returns a new file descriptor  referring  to that socket.  The newly created socket is not in the listening state.  The original socket  sockfd  is  unaffected  by  this call.

从监听的socket中取出一个连接请求创建一个新的未监听状态的socket.-&gt; cfd，原本处于监听状态的socket不受影响。

* 参数

1. sockfd：The  argument  sockfd is a socket that has been created with socket(2),bound to a local address with bind(2), and is listening for connections after a listen(2).

2. addr

The argument addr is a pointer to a sockaddr structure.  This structure is filled in with the address of the peer socket, as known to the  communications  layer.   The  exact format of the address returned addr is determined by the socket's address family (see socket(2)  and  the  
respective protocol man pages).  When addr is NULL, nothing is filled in;in this case, addrlen is not used, and should also be NULL.

addr是一个结构体指针，用客户端的socket来填充，

3. socklen_t

The addrlen argument is a value-result argument: the caller  must  initialize  it  to contain the size (in bytes) of the structure pointed to by addr; on return it will contain the actual size of the peer address.

* 返回值

成功返回当前进程的最小文件描述符，失败返回-1，errno被设置。and addrlen is left unchanged
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><ol start="5"><li>connect(2)</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>#include &lt;sys/types.h&gt;          /* See NOTES */
#include &lt;sys/socket.h&gt;
int connect(int sockfd, const struct sockaddr *addr,socklen_t addrlen);

* 描述
The  connect()  system call connects the socket referred to by the file descriptor sockfd to the address specified by addr. 

* 参数
1. sockfd

If  the  socket  is  of type SOCK_STREAM or SOCK_SEQPACKET, this call attempts to make a connection to  the  socket that is bound to the address specified by addr.

socket要求基于连接的socket.

2. sockaddr

服务器端socket的地址空间。the address specified by addr，

The format of the address in addr is determined by the address space of the socket sockfd;

3. addrlen

The addrlen  argument  specifies the size of addr.


* 返回值

成功返回0，失败返回-1，errno被设置。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>scoket地址格式:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>通用的地址格式：
struct sockaddr {
               sa_family_t sa_family;
               char        sa_data[14];
}
ipv4对应的地址格式 man 7 IP
struct sockaddr_in {
               sa_family_t    sin_family; /* address family: AF_INET */
               in_port_t      sin_port;   /* port in network byte order */
               struct in_addr sin_addr;   /* internet address */
           };

           /* Internet address. */
           struct in_addr {
               uint32_t       s_addr;     /* address in network byte order */
           };
           
两个结构体中的sa_family和sin_family字段，指定具体所使用的地址家族。

我们在代码中加入#include &lt;netinet/ip.h&gt;头文件，然后进行预编译。

可以看到typedef unsigned short int sa_family_t;
所以在结构体中sa_family占用两个字节

typedef uint16_t in_port_t;
typedef __uint16_t uint16_t;
typedef unsigned short int __uint16_t;

所以端口号也是无符号的短整形，占两个字节的长度。


struct in_addr是一个结构体类型，其中uint32_t是无符号整型，占4个字节，所以sin_addr也是占四个字节，

typedef __uint32_t uint32_t;
typedef unsigned int __uint32_t;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p><img src="/clang/address.png" alt="17d1e3fcd4b7cb7ba2a776b0cba639a5"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>当我们将struct sockaddr_in类型的地址转成struct sockaddr类型的地址时，sa_family和sin_family在内存中对应，
int_port和sin_addr在内存中对应sa_data中的前6个字节。我们使用connect和bind是指定了的addrlen指定了结构体的大小，我们只使用给定大小的空间便可以得到端口号和ipd地址。


struct sockaddr_in中要求sin_port为网络字节序，
网络字节序是大端的

主机字节序可能是大端也可能是小端。

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>主机字节序和网络字节序的转换</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#include &lt;arpa/inet.h&gt;

uint32_t htonl(uint32_t hostlong);

uint16_t htons(uint16_t hostshort);

uint32_t ntohl(uint32_t netlong);

uint16_t ntohs(uint16_t netshort);

* 描述

convert values between host and network byte order
h代表host,n代表net,l代表l,s代表short
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>此外ip地址一般是点分10进制的字符串，而我们上面的结构体中要求的是uint32.这就需要从text --&gt; binary</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#include &lt;arpa/inet.h&gt;

int inet_pton(int af, const char *src, void *dst);

* 描述
convert IPv4 and IPv6 addresses from text to binary form,dst is written in network byte order.

* 参数
1. af
AF_INET ipv4
AF_INET6 ipv6
2. src
代表ip地址的字符串
3.dist
保存转化后结果的地址

* 返回值

成功返回1，src不是合法的ip地址，返回0，af不是合法的地址家族返回-1.


#include &lt;arpa/inet.h&gt;

const char *inet_ntop(int af, const void *src,char *dst, socklen_t size);
* 描述

convert IPv4 and IPv6 addresses from binary to text form

* 参数

af：同上

src:binary类型的ip地址

dst 用来接受转化后字符串的缓存区

size 制定了缓存区的大小

* 返回值
成功返回dst指针，失败返回NULL,errno被设置。

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>代表ip地址的宏，这些宏实质是16进制的数字，需要转换成网络字节序。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>There are several special addresses: INADDR_LOOPBACK (127.0.0.1) always refers to the local host via the loopback device; INADDR_ANY (0.0.0.0) means any address for binding; INADDR_BROADCAST (255.255.255.255) means any host and has the same effect on bind as INADDR_ANY for historical reasons
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>代码参见：server.c client.c

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>setsockopt(2)</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>解决服务器频繁启用时系统资源回收不及时，端口占用的问题
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/clang/net1.html" class="prev">
        网络基础
      </a></span> <span class="next"><a href="/clang/net3.html">
        对tcp编程的代码进行封装
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9b56a05a.js" defer></script><script src="/assets/js/2.b22280cb.js" defer></script><script src="/assets/js/13.6add00c5.js" defer></script>
  </body>
</html>
