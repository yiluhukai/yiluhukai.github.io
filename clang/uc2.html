<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>uc2 | yiluhuakai</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.775e5fee.css" as="style"><link rel="preload" href="/assets/js/app.6fb23a83.js" as="script"><link rel="preload" href="/assets/js/2.b22280cb.js" as="script"><link rel="preload" href="/assets/js/14.f2386497.js" as="script"><link rel="prefetch" href="/assets/js/10.40461a30.js"><link rel="prefetch" href="/assets/js/11.d103858e.js"><link rel="prefetch" href="/assets/js/12.4232f768.js"><link rel="prefetch" href="/assets/js/13.b3734304.js"><link rel="prefetch" href="/assets/js/15.308a89ff.js"><link rel="prefetch" href="/assets/js/16.db389cec.js"><link rel="prefetch" href="/assets/js/17.cf828fcb.js"><link rel="prefetch" href="/assets/js/18.899e9438.js"><link rel="prefetch" href="/assets/js/19.580699e9.js"><link rel="prefetch" href="/assets/js/20.332c8709.js"><link rel="prefetch" href="/assets/js/21.375795c8.js"><link rel="prefetch" href="/assets/js/22.50502a93.js"><link rel="prefetch" href="/assets/js/23.687897f9.js"><link rel="prefetch" href="/assets/js/24.ebc77e7a.js"><link rel="prefetch" href="/assets/js/25.337c6ea9.js"><link rel="prefetch" href="/assets/js/26.e762b5ea.js"><link rel="prefetch" href="/assets/js/27.13464cd3.js"><link rel="prefetch" href="/assets/js/28.523d766a.js"><link rel="prefetch" href="/assets/js/29.3987be3f.js"><link rel="prefetch" href="/assets/js/3.de1a5954.js"><link rel="prefetch" href="/assets/js/30.ff074f82.js"><link rel="prefetch" href="/assets/js/31.44d32a6e.js"><link rel="prefetch" href="/assets/js/32.b9b36b40.js"><link rel="prefetch" href="/assets/js/33.abe84780.js"><link rel="prefetch" href="/assets/js/34.2fb44918.js"><link rel="prefetch" href="/assets/js/35.a3098855.js"><link rel="prefetch" href="/assets/js/36.05c89a1c.js"><link rel="prefetch" href="/assets/js/37.27eda115.js"><link rel="prefetch" href="/assets/js/38.1dff405e.js"><link rel="prefetch" href="/assets/js/39.35c28552.js"><link rel="prefetch" href="/assets/js/4.e26bf81a.js"><link rel="prefetch" href="/assets/js/40.6405a5c2.js"><link rel="prefetch" href="/assets/js/41.34a3cdb8.js"><link rel="prefetch" href="/assets/js/42.18986dd4.js"><link rel="prefetch" href="/assets/js/43.7fdfe078.js"><link rel="prefetch" href="/assets/js/44.283ea1af.js"><link rel="prefetch" href="/assets/js/45.6778b0eb.js"><link rel="prefetch" href="/assets/js/46.c9d8e532.js"><link rel="prefetch" href="/assets/js/47.74ec33ae.js"><link rel="prefetch" href="/assets/js/48.e6419c54.js"><link rel="prefetch" href="/assets/js/49.a850af05.js"><link rel="prefetch" href="/assets/js/5.ce8ed43a.js"><link rel="prefetch" href="/assets/js/50.7a85f1c4.js"><link rel="prefetch" href="/assets/js/51.e050e509.js"><link rel="prefetch" href="/assets/js/52.4e95e579.js"><link rel="prefetch" href="/assets/js/53.2c1823d9.js"><link rel="prefetch" href="/assets/js/54.dd273805.js"><link rel="prefetch" href="/assets/js/55.ef337569.js"><link rel="prefetch" href="/assets/js/56.f0e79429.js"><link rel="prefetch" href="/assets/js/57.eab487a7.js"><link rel="prefetch" href="/assets/js/58.3060e802.js"><link rel="prefetch" href="/assets/js/59.a7db315a.js"><link rel="prefetch" href="/assets/js/6.a3856d53.js"><link rel="prefetch" href="/assets/js/60.99117954.js"><link rel="prefetch" href="/assets/js/61.805588a2.js"><link rel="prefetch" href="/assets/js/62.bb5d85a6.js"><link rel="prefetch" href="/assets/js/7.02b760da.js"><link rel="prefetch" href="/assets/js/8.78eceb25.js"><link rel="prefetch" href="/assets/js/9.196b0b91.js">
    <link rel="stylesheet" href="/assets/css/0.styles.775e5fee.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">yiluhuakai</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/leetcode/" class="nav-link">
  LeetCode
</a></div><div class="nav-item"><a href="/golang/" class="nav-link">
  Go
</a></div><div class="nav-item"><a href="/mysql/" class="nav-link">
  Mysql
</a></div><div class="nav-item"><a href="/clang/" class="nav-link router-link-active">
  C语言
</a></div><div class="nav-item"><a href="/es/" class="nav-link">
  前端
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/leetcode/" class="nav-link">
  LeetCode
</a></div><div class="nav-item"><a href="/golang/" class="nav-link">
  Go
</a></div><div class="nav-item"><a href="/mysql/" class="nav-link">
  Mysql
</a></div><div class="nav-item"><a href="/clang/" class="nav-link router-link-active">
  C语言
</a></div><div class="nav-item"><a href="/es/" class="nav-link">
  前端
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/clang/Linux命令.html" class="sidebar-link">Linux命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#位运算符-操作比特位" class="sidebar-link">位运算符（操作比特位）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#条件运算符" class="sidebar-link" style="padding-left:3rem;">条件运算符</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#比较运算符" class="sidebar-link" style="padding-left:3rem;">比较运算符</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#逻辑运算符" class="sidebar-link" style="padding-left:3rem;">逻辑运算符</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#流程控制语句" class="sidebar-link" style="padding-left:3rem;">流程控制语句</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#函数" class="sidebar-link">函数</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#递归和循环" class="sidebar-link" style="padding-left:3rem;">递归和循环</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#变量的作用域和及生命周期" class="sidebar-link">变量的作用域和及生命周期</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#局部变量" class="sidebar-link" style="padding-left:3rem;">局部变量</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#全局变量" class="sidebar-link" style="padding-left:3rem;">全局变量</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#static变量" class="sidebar-link" style="padding-left:3rem;">static变量</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#指针" class="sidebar-link">指针</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#指针的作用" class="sidebar-link" style="padding-left:3rem;">指针的作用</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#野指针" class="sidebar-link" style="padding-left:3rem;">野指针</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#不要在函数中返回一个局部变量的地址" class="sidebar-link" style="padding-left:3rem;">不要在函数中返回一个局部变量的地址</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#指针的运算" class="sidebar-link" style="padding-left:3rem;">指针的运算</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#数组名相当于一个不能移动的指针。" class="sidebar-link" style="padding-left:3rem;">数组名相当于一个不能移动的指针。</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#const关键字" class="sidebar-link">const关键字</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#数组和指针的区别" class="sidebar-link" style="padding-left:3rem;">数组和指针的区别</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#字符和字符串" class="sidebar-link">字符和字符串</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#字符串的输出" class="sidebar-link" style="padding-left:3rem;">字符串的输出</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#字符串的运算" class="sidebar-link">字符串的运算</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#copy" class="sidebar-link" style="padding-left:3rem;">copy</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#字符串的比较-strcmp" class="sidebar-link" style="padding-left:3rem;">字符串的比较（strcmp）</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#strlen-char-str-不包括-0" class="sidebar-link" style="padding-left:3rem;">strlen(char * str)，不包括'\0';</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#char-strcat-char-dest-const-char-src-将b连接在a的后面。" class="sidebar-link" style="padding-left:3rem;">char strcat(char dest, const char *src);将b连接在a的后面。</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#memset-char-a-0-20-清空字符串-使用20个0来填充。" class="sidebar-link" style="padding-left:3rem;">memset(char * a ,0,20),清空字符串，使用20个0来填充。</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#指向多个字符串" class="sidebar-link">指向多个字符串</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#main函数的函数原型" class="sidebar-link">main函数的函数原型</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#c程序的编译过程" class="sidebar-link">c程序的编译过程</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#_1-预处理" class="sidebar-link" style="padding-left:3rem;">1.预处理</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#_2-编译" class="sidebar-link" style="padding-left:3rem;">2.编译</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#_3-汇编" class="sidebar-link" style="padding-left:3rem;">3.汇编</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#_4-链接" class="sidebar-link" style="padding-left:3rem;">4.链接</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#预处理指令" class="sidebar-link">预处理指令</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#_1-头文件" class="sidebar-link" style="padding-left:3rem;">1.头文件</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#_2-宏" class="sidebar-link" style="padding-left:3rem;">2.宏</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#条件编译" class="sidebar-link">条件编译</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#内置宏变量" class="sidebar-link">内置宏变量</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#include-和-include-的区别" class="sidebar-link">#include 和 #include &quot;&quot;的区别</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#分文件调用" class="sidebar-link">分文件调用</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#static-和-extern" class="sidebar-link">static 和 extern</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#头文件的引用" class="sidebar-link">头文件的引用</a></li><li class="sidebar-sub-header"><a href="/clang/Linux命令.html#make-和makefile" class="sidebar-link">make 和makefile</a></li></ul></li></ul></li><li><a href="/clang/结构体.html" class="sidebar-link">结构体</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/指针高级.html" class="sidebar-link">指针高级</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/stdlib标准库函数.html" class="sidebar-link">标准库函数</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/datastruct.html" class="sidebar-link">数据结构主要研究的如何使用存储区(内存)存储数字</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc1.html" class="sidebar-link">复习:uc1</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc2.html" aria-current="page" class="active sidebar-link">uc2</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc3.html" class="sidebar-link">uc3</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc4.html" class="sidebar-link">uc4</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc5.html" class="sidebar-link">uc5</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc6.html" class="sidebar-link">uc6</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc7.html" class="sidebar-link">uc7</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/计算机网络.html" class="sidebar-link">网络基础</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/计算机网络2.html" class="sidebar-link">ip地址</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/网络编程3.html" class="sidebar-link">对tcp编程的代码进行封装</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/网络编程udp.html" class="sidebar-link">udp编程模型</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/thread.html" class="sidebar-link">线程基础</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/信号集和信号屏蔽.html" class="sidebar-link">信号阻塞</a><ul class="sidebar-sub-headers"></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="uc2"><a href="#uc2" class="header-anchor">#</a> uc2</h3> <p>segment/segment.c 产生端错误</p> <h3 id="哈弗结构和冯诺依曼结构"><a href="#哈弗结构和冯诺依曼结构" class="header-anchor">#</a> 哈弗结构和冯诺依曼结构</h3> <p>哈弗结构得指令和数据是分开的。
冯诺依曼结构的指令和数据是不分开的。所以只能线性执行，效率比较低，而哈弗结构在读取数据执行的同时可以去缓存下一条指令。</p> <p>CS 寄存器中保存的是程序的代码段（segment）在内存中的的首地址(虚拟地址)。
DS 寄存器保存的程序数据段在内存中的开始地址。
SS 寄存器保存的是程序在栈段在内存中的首地址。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>gcc -S file.c -o file.s
<span class="token function">vim</span> file.s
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>可以看到</p> <p><img src="/clang/DB01BEC0-69FF-4589-8FB0-DD9BF525A5AC.png" alt="80473776b0368443a04b835bef6cba79"></p> <p>位于.section  .rodata和text之间的就是数据section
<img src="/clang/F1BB67D4-8B96-4F45-903B-2D24C60A9288.png" alt="47e36789ba94c95cff6b5ab8968275c6">
位于text和section .note gnu-stack  之间的是代码section</p> <p>gnu-stack下面的是栈section</p> <p>当我们在链接时，会把不同的目标文件的数据section和并到一块。形成数据segment。指令section和栈section也会合并成对应的代码segment和栈segment.当我们执行这个可执行文件的时候，cpu的ss、ds、cs寄存器器会指向程序在内存中不同的段的开始地址。</p> <p>代码段 只读 可执行</p> <p>数据段 读写 不可执行</p> <p>栈段</p> <h3 id="查看进程的内存中的段地址"><a href="#查看进程的内存中的段地址" class="header-anchor">#</a> 查看进程的内存中的段地址</h3> <p>#include &lt;sys/types.h&gt;
#include &lt;unistd.h&gt;</p> <p>getpid(2)
pid_t getpid(void); returns the process ID of the calling process.</p> <p>pid_t是int的别名。可以通过下面的方法去查看</p> <p>文件中包含这两个头文件，然后执行预处理指令操作。完成之后用vim代开对应*.i文件。
然后 /pid_t去查找。</p> <p>memory_04/memory.c</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">char</span><span class="token operator">*</span>  str1 <span class="token operator">=</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">char</span><span class="token operator">*</span>  str2 <span class="token operator">=</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">char</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token operator">=</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;pid = %d\n&quot;</span><span class="token punctuation">,</span><span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// str1的空间分配在哪里</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;str1 address =%p\n&quot;</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>str1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// str1的内容在什么位置</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;str1 content =%p\n&quot;</span><span class="token punctuation">,</span>str1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// str1和str2的内容是否相同</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;str2 content =%p\n&quot;</span><span class="token punctuation">,</span>str2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;arr content =%p\n&quot;</span><span class="token punctuation">,</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>运行上面的文件，结果如下：</p> <p><img src="/clang/2B82A5B3-AF1C-4E31-806A-11825A27A891.png" alt="d6a5fa42325d4c9b605c4054667fac03"></p> <p>运行对应的指令去查看进程内存地址</p> <p><img src="/clang/18939E10-47ED-4CB6-AAE8-6678B02CEE88.png" alt="f0c6398723e511ac2b2f46b505aafd12"></p> <p>其中第一个a.out的执行权限是可读可执行的是代码段，我们对比可以发现str1和str2的内容相同且在代码段。而str1、str2内存空间在栈段（stack）.而arr的内容在栈段，当我们用hello wolrd初始化字符数组时，其实并没有把数组名这个字符指针指向代码段的hello wolrd.而是在栈段开辟内存空间，然后把这个&quot;hello wolrd&quot;这个字符串copy到了这个空间里。</p> <p><img src="/clang/memory.png" alt="660eb6c1db39024664ff5baf5a1e9b95"></p> <div class="language-c line-numbers-mode"><pre class="language-c"><code>
<span class="token keyword">char</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
arr <span class="token operator">=</span> <span class="token string">&quot;hello wolrd&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这个语句会报错，是因为arr时一个常指针，不能将他指向代码段的内存空间。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">char</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">strcpy</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span><span class="token string">&quot;hello wolrd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="栈段的内容"><a href="#栈段的内容" class="header-anchor">#</a> 栈段的内容</h3> <p>栈段是由栈帧组成的，每个函数对应这一个栈帧，当调用一个函数的，会将一些变量的数据保存在栈帧中，函数调用结束，会将这个栈帧出栈，保存的变量信息会被销毁。这种变量的生命周期是由函数的生命周期决定的。这种变量包含auto局部变量和函数的形参。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token keyword">void</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\t%p\n&quot;</span><span class="token punctuation">,</span><span class="token operator">++</span>i<span class="token punctuation">,</span><span class="token operator">&amp;</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;PID:%d\n&quot;</span><span class="token punctuation">,</span><span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> j <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>执行结果</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>PID:7428
2	0x7fff3969590c
2	0x7fff3969590c
2	0x7fff3969590c
2	0x7fff3969590c
2	0x7fff3969590c
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>查看当前进程的内存信息 cat /proc/7428/maps</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>559220448000-559220449000 r-xp 00000000 08:01 1574689                    /home/yiluhuakai/C-/uc/memory_04/a.out
559220648000-559220649000 r--p 00000000 08:01 1574689                    /home/yiluhuakai/C-/uc/memory_04/a.out
559220649000-55922064a000 rw-p 00001000 08:01 1574689                    /home/yiluhuakai/C-/uc/memory_04/a.out
559222570000-559222591000 rw-p 00000000 00:00 0                          [heap]
7f035b127000-7f035b2bc000 r-xp 00000000 08:01 262152                     /lib/x86_64-linux-gnu/libc-2.24.so
7f035b2bc000-7f035b4bc000 ---p 00195000 08:01 262152                     /lib/x86_64-linux-gnu/libc-2.24.so
7f035b4bc000-7f035b4c0000 r--p 00195000 08:01 262152                     /lib/x86_64-linux-gnu/libc-2.24.so
7f035b4c0000-7f035b4c2000 rw-p 00199000 08:01 262152                     /lib/x86_64-linux-gnu/libc-2.24.so
7f035b4c2000-7f035b4c6000 rw-p 00000000 00:00 0 
7f035b4c6000-7f035b4e9000 r-xp 00000000 08:01 262147                     /lib/x86_64-linux-gnu/ld-2.24.so
7f035b6cc000-7f035b6ce000 rw-p 00000000 00:00 0 
7f035b6e9000-7f035b6ea000 r--p 00023000 08:01 262147                     /lib/x86_64-linux-gnu/ld-2.24.so
7f035b6ea000-7f035b6eb000 rw-p 00024000 08:01 262147                     /lib/x86_64-linux-gnu/ld-2.24.so
7f035b6eb000-7f035b6ec000 rw-p 00000000 00:00 0 
7fff39677000-7fff39698000 rw-p 00000000 00:00 0                          [stack]
7fff396bf000-7fff396c1000 r--p 00000000 00:00 0                          [vvar]
7fff396c1000-7fff396c3000 r-xp 00000000 00:00 0                          [vdso]
ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>我们可以看到变量的内存地址是位于栈段中的。</p> <p>当我们将上面的变量i改成static类型的。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>

<span class="token keyword">void</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">static</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\t%p\n&quot;</span><span class="token punctuation">,</span><span class="token operator">++</span>i<span class="token punctuation">,</span><span class="token operator">&amp;</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;PID:%d\n&quot;</span><span class="token punctuation">,</span><span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> j <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>PID:7438
2	0x55ffec246040
3	0x55ffec246040
4	0x55ffec246040
5	0x55ffec246040
6	0x55ffec246040
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>内存使用</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>55ffec045000-55ffec046000 r-xp 00000000 08:01 1574689                    /home/yiluhuakai/C-/uc/memory_04/a.out
55ffec245000-55ffec246000 r--p 00000000 08:01 1574689                    /home/yiluhuakai/C-/uc/memory_04/a.out
55ffec246000-55ffec247000 rw-p 00001000 08:01 1574689                    /home/yiluhuakai/C-/uc/memory_04/a.out
55ffecb8b000-55ffecbac000 rw-p 00000000 00:00 0                          [heap]
7f583042d000-7f58305c2000 r-xp 00000000 08:01 262152                     /lib/x86_64-linux-gnu/libc-2.24.so
7f58305c2000-7f58307c2000 ---p 00195000 08:01 262152                     /lib/x86_64-linux-gnu/libc-2.24.so
7f58307c2000-7f58307c6000 r--p 00195000 08:01 262152                     /lib/x86_64-linux-gnu/libc-2.24.so
7f58307c6000-7f58307c8000 rw-p 00199000 08:01 262152                     /lib/x86_64-linux-gnu/libc-2.24.so
7f58307c8000-7f58307cc000 rw-p 00000000 00:00 0 
7f58307cc000-7f58307ef000 r-xp 00000000 08:01 262147                     /lib/x86_64-linux-gnu/ld-2.24.so
7f58309d2000-7f58309d4000 rw-p 00000000 00:00 0 
7f58309ef000-7f58309f0000 r--p 00023000 08:01 262147                     /lib/x86_64-linux-gnu/ld-2.24.so
7f58309f0000-7f58309f1000 rw-p 00024000 08:01 262147                     /lib/x86_64-linux-gnu/ld-2.24.so
7f58309f1000-7f58309f2000 rw-p 00000000 00:00 0 
7ffdfb243000-7ffdfb264000 rw-p 00000000 00:00 0                          [stack]
7ffdfb3f7000-7ffdfb3f9000 r--p 00000000 00:00 0                          [vvar]
7ffdfb3f9000-7ffdfb3fb000 r-xp 00000000 00:00 0                          [vdso]
ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>我们看出static变量是分配在数据段上，他的生命周期和进程的生命周期相同。每次执行函数，会在数据段上查找是否存在变量i,找到则不会初始化，直接使用这个变量去运算。所以结果是递增的。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token keyword">const</span> <span class="token keyword">int</span> var_g <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> var_global <span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">static</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%d\t%p\n&quot;</span><span class="token punctuation">,</span><span class="token operator">++</span>i<span class="token punctuation">,</span><span class="token operator">&amp;</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;var_g address=%p\n&quot;</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>var_g<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;var_global address=%p\n&quot;</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>var_global<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> <span class="token keyword">int</span> s <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> <span class="token operator">*</span> <span class="token keyword">const</span>  p <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">;</span>
        <span class="token operator">*</span>p <span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;s =%d\n&quot;</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;s address %p\n&quot;</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;PID:%d\n&quot;</span><span class="token punctuation">,</span><span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>结果：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ar_g address=0x55b4464108a4
var_global address=0x55b446611040
s =100
s address 0x7fffdb355184
PID:7872
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>内存分布：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>55b446410000-55b446411000 r-xp 00000000 08:01 1574511                    /home/yiluhuakai/C-/uc/memory_04/a.out
55b446610000-55b446611000 r--p 00000000 08:01 1574511                    /home/yiluhuakai/C-/uc/memory_04/a.out
55b446611000-55b446612000 rw-p 00001000 08:01 1574511                    /home/yiluhuakai/C-/uc/memory_04/a.out
55b446830000-55b446851000 rw-p 00000000 00:00 0                          [heap]
7fbc32d46000-7fbc32edb000 r-xp 00000000 08:01 262152                     /lib/x86_64-linux-gnu/libc-2.24.so
7fbc32edb000-7fbc330db000 ---p 00195000 08:01 262152                     /lib/x86_64-linux-gnu/libc-2.24.so
7fbc330db000-7fbc330df000 r--p 00195000 08:01 262152                     /lib/x86_64-linux-gnu/libc-2.24.so
7fbc330df000-7fbc330e1000 rw-p 00199000 08:01 262152                     /lib/x86_64-linux-gnu/libc-2.24.so
7fbc330e1000-7fbc330e5000 rw-p 00000000 00:00 0 
7fbc330e5000-7fbc33108000 r-xp 00000000 08:01 262147                     /lib/x86_64-linux-gnu/ld-2.24.so
7fbc332eb000-7fbc332ed000 rw-p 00000000 00:00 0 
7fbc33308000-7fbc33309000 r--p 00023000 08:01 262147                     /lib/x86_64-linux-gnu/ld-2.24.so
7fbc33309000-7fbc3330a000 rw-p 00024000 08:01 262147                     /lib/x86_64-linux-gnu/ld-2.24.so
7fbc3330a000-7fbc3330b000 rw-p 00000000 00:00 0 
7fffdb336000-7fffdb357000 rw-p 00000000 00:00 0                          [stack]
7fffdb3ee000-7fffdb3f0000 r--p 00000000 00:00 0                          [vvar]
7fffdb3f0000-7fffdb3f2000 r-xp 00000000 00:00 0                          [vdso]
ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>全局变量var_global是位于数据段的，生命周期和当前进程一致。全局常量var_g位于代码段，只读。局部常量位于stack段，通过变量名称去访问时是只读的，但是我们可以使用指针指向这片内存，然后去修改数据，因为stack段是可读写的。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>


<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">int</span><span class="token operator">*</span> mp <span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//在堆上分配内存空间</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;PID = %d\n&quot;</span><span class="token punctuation">,</span><span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//打印内存地址</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;mp point address =%p\n&quot;</span><span class="token punctuation">,</span>mp<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">free</span><span class="token punctuation">(</span>mp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;map oint address =%p\n&quot;</span><span class="token punctuation">,</span>mp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>结果</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>PID = 8115
mp point address =0x55a7b30e9010
map oint address =0x55a7b30e9010
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>内存分配</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>55a7b112f000-55a7b1130000 r-xp 00000000 08:01 1574511                    /home/yiluhuakai/C-/uc/memory_04/a.out
55a7b132f000-55a7b1330000 r--p 00000000 08:01 1574511                    /home/yiluhuakai/C-/uc/memory_04/a.out
55a7b1330000-55a7b1331000 rw-p 00001000 08:01 1574511                    /home/yiluhuakai/C-/uc/memory_04/a.out
55a7b30e9000-55a7b310a000 rw-p 00000000 00:00 0                          [heap]
7f2c2ea51000-7f2c2ebe6000 r-xp 00000000 08:01 262152                     /lib/x86_64-linux-gnu/libc-2.24.so
7f2c2ebe6000-7f2c2ede6000 ---p 00195000 08:01 262152                     /lib/x86_64-linux-gnu/libc-2.24.so
7f2c2ede6000-7f2c2edea000 r--p 00195000 08:01 262152                     /lib/x86_64-linux-gnu/libc-2.24.so
7f2c2edea000-7f2c2edec000 rw-p 00199000 08:01 262152                     /lib/x86_64-linux-gnu/libc-2.24.so
7f2c2edec000-7f2c2edf0000 rw-p 00000000 00:00 0 
7f2c2edf0000-7f2c2ee13000 r-xp 00000000 08:01 262147                     /lib/x86_64-linux-gnu/ld-2.24.so
7f2c2eff6000-7f2c2eff8000 rw-p 00000000 00:00 0 
7f2c2f013000-7f2c2f014000 r--p 00023000 08:01 262147                     /lib/x86_64-linux-gnu/ld-2.24.so
7f2c2f014000-7f2c2f015000 rw-p 00024000 08:01 262147                     /lib/x86_64-linux-gnu/ld-2.24.so
7f2c2f015000-7f2c2f016000 rw-p 00000000 00:00 0 
7ffdd63cf000-7ffdd63f0000 rw-p 00000000 00:00 0                          [stack]
7ffdd63f3000-7ffdd63f5000 r--p 00000000 00:00 0                          [vvar]
7ffdd63f5000-7ffdd63f7000 r-xp 00000000 00:00 0                          [vdso]
ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>我们可以看到使用malloc分配的内存在heap上。当我们呢调用free函数释放后，该片内存可以被其他资源占用。但是指针还是指向该片内存，所以我们要把指针指向NULL.</p> <h3 id="每个进程都会分配独立的4g内存空间。"><a href="#每个进程都会分配独立的4g内存空间。" class="header-anchor">#</a> 每个进程都会分配独立的4G内存空间。</h3> <p><img src="/clang/FF5F7E1A-71CA-4186-85D9-4851468BB615.png" alt="98b7063b9314aed18afbda54ad70ff88"></p> <h3 id="将物理地址-物理内存-映射到虚拟地址-虚拟内存"><a href="#将物理地址-物理内存-映射到虚拟地址-虚拟内存" class="header-anchor">#</a> 将物理地址（物理内存）映射到虚拟地址（虚拟内存）</h3> <p>1.将物理地址映射到内存中</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#include &lt;sys/mman.h&gt;
void *
     mmap(void *addr, size_t len, int prot, int flags, int fd, off_t offset);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>函数的功能： allocate memory, or map files or devices into memory。分配或映射文件或设备到虚拟地址。</p> <p>函数的参数：</p> <p>addr 指定映射的开始地址,当为NULL时由系统指定。
len  映射中page的长度,不足一页安一页的大小算。
prot 指定映射地址的访问权限</p> <p>PROT_NONE   Pages may not be accessed.
PROT_READ   Pages may be read.
PROT_WRITE  Pages may be written.
PROT_EXEC   Pages may be executed.</p> <p>flag  指定映射地址的修改对其他进程是否可见和映射的类型</p> <p>MAP_PRIVATE       Modifications are private (copy-on-write).
对虚拟地址的更新对其他进程不可见，且不会同步到底层物理地址。</p> <p>MAP_SHARED        Modifications are shared.
进程间可见，且会同步到底层的物理空间中。</p> <p>MAP_ANON （匿名映射:不可以和MAP_SHARED或，且fd和offset被忽略。
此时fd一般被设置为-1，offset一般是页大小的（4k）的整数倍，可以为0.
匿名映射指的是映射到虚拟地址物理地址是匿名的，不与任何文件关联。</p> <p>参数fd：要映射到内存中的文件描述符。如果使用匿名内存映射时，即flags中设置了MAP_ANONYMOUS，fd设为-1。</p> <p>参数offset：文件映射的偏移量，通常设置为0，代表从文件最前方开始对应，offset必须是分页大小的整数倍。</p> <p>返回值：
Upon successful completion, mmap() returns a pointer to the mapped region.  Otherwise, a value of MAP_FAILED is returned
and errno is set to indicate the error.</p> <p>2.取消映射</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#include &lt;sys/mman.h&gt;
int munmap(void *addr, size_t len);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="文件操作的函数"><a href="#文件操作的函数" class="header-anchor">#</a> 文件操作的函数</h3> <p>1.open</p> <p>fopen、fclose等库函数都是对系统函数(open(2) 、close(2))的封装.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> #include &lt;fcntl.h&gt;
 int open(const char *path, int oflag, ...);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>功能：open or create a file for reading or writing</p> <p>参数：</p> <ul><li><p>path代表文件的路径</p></li> <li><p>oflag代表文件指定文件的访问权限。可以是下面的值。</p></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code> O_RDONLY        open for reading only
 O_WRONLY        open for writing only
 O_RDWR          open for reading and writing
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>同时可以文件的创建或者状态标记安位或。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>O_APPEND        append on each write
O_CREAT         create file if it does not exist and need third arguement mode（mode of user）.

O_TRUNC         truncate size to 0 if file exist
O_EXCL          error if O_CREAT and the file exists，
和O_CREAT一块使用的时候且文件存在会报错，文件不存在，创建新的文件。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>... 可变参数</li></ul> <p>该函数中用来指定当创建一个新的文件时指定执行文件的权限（mode）</p> <p>mode.
linux文件包括所有者，所在组和其他组用户对文件的权限。
rwx-rwx-rwx.
指定文件的权限：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>u代表所有者，g代表所有组，o代表其他组，a代表所有人
   eg：设置权限
   <span class="token function">chmod</span> <span class="token assign-left variable">u</span><span class="token operator">=</span>rw,g<span class="token operator">=</span>w,o<span class="token operator">=</span>wx 文件或者目录
   eg:chomd u+r 文件或者目录
   eg：chmod u-r  文件或者目录
   eg:chmod a+x 文件或者目录
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>用三位二进制表示文件权限。</p> <p>111  =  rwx</p> <p>100 = r__</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token assign-left variable">r</span><span class="token operator">=</span><span class="token number">4</span>，w<span class="token operator">=</span><span class="token number">2</span>,x<span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">rwx</span><span class="token operator">=</span><span class="token number">7</span>
   eg:chomd <span class="token assign-left variable">u</span><span class="token operator">=</span>rwx,g<span class="token operator">=</span>rw,a<span class="token operator">=</span>x aa.txt
   等价于：
   <span class="token function">chmod</span> <span class="token number">761</span> aa.txt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>rwx中xxx会构成一组新的权限，权限的值可以位01234567.</p> <p>默认为0，我们可以通过chmod 1644中的第一个数去指定,ls -ahl可以看到其他组权限变成了S.</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/8/2021, 2:52:06 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/clang/uc1.html" class="prev">
        复习:uc1
      </a></span> <span class="next"><a href="/clang/uc3.html">
        uc3
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6fb23a83.js" defer></script><script src="/assets/js/2.b22280cb.js" defer></script><script src="/assets/js/14.f2386497.js" defer></script>
  </body>
</html>
