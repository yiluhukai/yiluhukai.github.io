<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>uc3 | yiluhuakai</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.992cb7aa.css" as="style"><link rel="preload" href="/assets/js/app.9b56a05a.js" as="script"><link rel="preload" href="/assets/js/2.b22280cb.js" as="script"><link rel="preload" href="/assets/js/22.1419ba41.js" as="script"><link rel="prefetch" href="/assets/js/10.413ab2ab.js"><link rel="prefetch" href="/assets/js/100.2d785741.js"><link rel="prefetch" href="/assets/js/101.a9fd3349.js"><link rel="prefetch" href="/assets/js/11.99f54ddd.js"><link rel="prefetch" href="/assets/js/12.c46f64f3.js"><link rel="prefetch" href="/assets/js/13.6add00c5.js"><link rel="prefetch" href="/assets/js/14.40115781.js"><link rel="prefetch" href="/assets/js/15.c3827c6c.js"><link rel="prefetch" href="/assets/js/16.304d275d.js"><link rel="prefetch" href="/assets/js/17.006e2fe4.js"><link rel="prefetch" href="/assets/js/18.7f93828f.js"><link rel="prefetch" href="/assets/js/19.a72c6116.js"><link rel="prefetch" href="/assets/js/20.d175ff74.js"><link rel="prefetch" href="/assets/js/21.7092a034.js"><link rel="prefetch" href="/assets/js/23.ce5e3c1b.js"><link rel="prefetch" href="/assets/js/24.9f9edaa3.js"><link rel="prefetch" href="/assets/js/25.a57ae5dc.js"><link rel="prefetch" href="/assets/js/26.5ba697f1.js"><link rel="prefetch" href="/assets/js/27.9ecaa5dc.js"><link rel="prefetch" href="/assets/js/28.290c65fe.js"><link rel="prefetch" href="/assets/js/29.bdbc3eeb.js"><link rel="prefetch" href="/assets/js/3.ac44586b.js"><link rel="prefetch" href="/assets/js/30.6f37d998.js"><link rel="prefetch" href="/assets/js/31.b1ac1238.js"><link rel="prefetch" href="/assets/js/32.024f8182.js"><link rel="prefetch" href="/assets/js/33.202e11b5.js"><link rel="prefetch" href="/assets/js/34.e755ffc0.js"><link rel="prefetch" href="/assets/js/35.376b8f63.js"><link rel="prefetch" href="/assets/js/36.56735f24.js"><link rel="prefetch" href="/assets/js/37.b7d03c63.js"><link rel="prefetch" href="/assets/js/38.d9407e30.js"><link rel="prefetch" href="/assets/js/39.4f87e45d.js"><link rel="prefetch" href="/assets/js/4.a4a037c8.js"><link rel="prefetch" href="/assets/js/40.5a53ee48.js"><link rel="prefetch" href="/assets/js/41.f7fa6a68.js"><link rel="prefetch" href="/assets/js/42.3c07d4ad.js"><link rel="prefetch" href="/assets/js/43.2965402d.js"><link rel="prefetch" href="/assets/js/44.fef5da48.js"><link rel="prefetch" href="/assets/js/45.ff058ba7.js"><link rel="prefetch" href="/assets/js/46.5a74f2cd.js"><link rel="prefetch" href="/assets/js/47.5931bb97.js"><link rel="prefetch" href="/assets/js/48.cbf85ab3.js"><link rel="prefetch" href="/assets/js/49.0319f8e4.js"><link rel="prefetch" href="/assets/js/5.d0d45788.js"><link rel="prefetch" href="/assets/js/50.497cb73f.js"><link rel="prefetch" href="/assets/js/51.4b6e5c5b.js"><link rel="prefetch" href="/assets/js/52.f4edf34f.js"><link rel="prefetch" href="/assets/js/53.df9c0557.js"><link rel="prefetch" href="/assets/js/54.1654be3b.js"><link rel="prefetch" href="/assets/js/55.c9e37e1f.js"><link rel="prefetch" href="/assets/js/56.052c5808.js"><link rel="prefetch" href="/assets/js/57.cf8cebef.js"><link rel="prefetch" href="/assets/js/58.220252cd.js"><link rel="prefetch" href="/assets/js/59.7e76271a.js"><link rel="prefetch" href="/assets/js/6.b5583d51.js"><link rel="prefetch" href="/assets/js/60.38c88311.js"><link rel="prefetch" href="/assets/js/61.c4b0da1c.js"><link rel="prefetch" href="/assets/js/62.d8be952c.js"><link rel="prefetch" href="/assets/js/63.19c02fd0.js"><link rel="prefetch" href="/assets/js/64.9d51d342.js"><link rel="prefetch" href="/assets/js/65.31c63e7c.js"><link rel="prefetch" href="/assets/js/66.badcb6df.js"><link rel="prefetch" href="/assets/js/67.83764c63.js"><link rel="prefetch" href="/assets/js/68.152c45b6.js"><link rel="prefetch" href="/assets/js/69.2119cafb.js"><link rel="prefetch" href="/assets/js/7.d21b1042.js"><link rel="prefetch" href="/assets/js/70.ff7211f3.js"><link rel="prefetch" href="/assets/js/71.26e7783e.js"><link rel="prefetch" href="/assets/js/72.dc5a3ba6.js"><link rel="prefetch" href="/assets/js/73.d8356ad1.js"><link rel="prefetch" href="/assets/js/74.10184aff.js"><link rel="prefetch" href="/assets/js/75.716811ca.js"><link rel="prefetch" href="/assets/js/76.046e6155.js"><link rel="prefetch" href="/assets/js/77.d287e80f.js"><link rel="prefetch" href="/assets/js/78.635ed9d3.js"><link rel="prefetch" href="/assets/js/79.4485123f.js"><link rel="prefetch" href="/assets/js/8.8bd3dfa9.js"><link rel="prefetch" href="/assets/js/80.74fc122c.js"><link rel="prefetch" href="/assets/js/81.cb3ce31c.js"><link rel="prefetch" href="/assets/js/82.bf81591e.js"><link rel="prefetch" href="/assets/js/83.01b0002d.js"><link rel="prefetch" href="/assets/js/84.6af4ae46.js"><link rel="prefetch" href="/assets/js/85.31122a7c.js"><link rel="prefetch" href="/assets/js/86.7641b1ab.js"><link rel="prefetch" href="/assets/js/87.63912fdd.js"><link rel="prefetch" href="/assets/js/88.01d6d061.js"><link rel="prefetch" href="/assets/js/89.ec494ad7.js"><link rel="prefetch" href="/assets/js/9.17f8341c.js"><link rel="prefetch" href="/assets/js/90.a2905192.js"><link rel="prefetch" href="/assets/js/91.5b1b5e00.js"><link rel="prefetch" href="/assets/js/92.f8112523.js"><link rel="prefetch" href="/assets/js/93.8e9fd5a8.js"><link rel="prefetch" href="/assets/js/94.41217af6.js"><link rel="prefetch" href="/assets/js/95.b253d44f.js"><link rel="prefetch" href="/assets/js/96.76495ed0.js"><link rel="prefetch" href="/assets/js/97.9f48729e.js"><link rel="prefetch" href="/assets/js/98.0e36c4a8.js"><link rel="prefetch" href="/assets/js/99.5b6ab9af.js">
    <link rel="stylesheet" href="/assets/css/0.styles.992cb7aa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">yiluhuakai</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/leetcode/" class="nav-link">
  LeetCode
</a></div><div class="nav-item"><a href="/golang/" class="nav-link">
  Go
</a></div><div class="nav-item"><a href="/mysql/" class="nav-link">
  Mysql
</a></div><div class="nav-item"><a href="/clang/" class="nav-link router-link-active">
  C语言
</a></div><div class="nav-item"><a href="/es/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/nodejs/" class="nav-link">
  nodejs
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/java/" class="nav-link">
  Java
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/leetcode/" class="nav-link">
  LeetCode
</a></div><div class="nav-item"><a href="/golang/" class="nav-link">
  Go
</a></div><div class="nav-item"><a href="/mysql/" class="nav-link">
  Mysql
</a></div><div class="nav-item"><a href="/clang/" class="nav-link router-link-active">
  C语言
</a></div><div class="nav-item"><a href="/es/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/nodejs/" class="nav-link">
  nodejs
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/java/" class="nav-link">
  Java
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/clang/linux.html" class="sidebar-link">Linux命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/clang/linux.html#位运算符-操作比特位" class="sidebar-link">位运算符（操作比特位）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/clang/linux.html#条件运算符" class="sidebar-link" style="padding-left:3rem;">条件运算符</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#比较运算符" class="sidebar-link" style="padding-left:3rem;">比较运算符</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#逻辑运算符" class="sidebar-link" style="padding-left:3rem;">逻辑运算符</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#流程控制语句" class="sidebar-link" style="padding-left:3rem;">流程控制语句</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#函数" class="sidebar-link">函数</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#递归和循环" class="sidebar-link" style="padding-left:3rem;">递归和循环</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#变量的作用域和及生命周期" class="sidebar-link">变量的作用域和及生命周期</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#局部变量" class="sidebar-link" style="padding-left:3rem;">局部变量</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#全局变量" class="sidebar-link" style="padding-left:3rem;">全局变量</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#static变量" class="sidebar-link" style="padding-left:3rem;">static变量</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#指针" class="sidebar-link">指针</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#指针的作用" class="sidebar-link" style="padding-left:3rem;">指针的作用</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#野指针" class="sidebar-link" style="padding-left:3rem;">野指针</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#不要在函数中返回一个局部变量的地址" class="sidebar-link" style="padding-left:3rem;">不要在函数中返回一个局部变量的地址</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#指针的运算" class="sidebar-link" style="padding-left:3rem;">指针的运算</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#数组名相当于一个不能移动的指针。" class="sidebar-link" style="padding-left:3rem;">数组名相当于一个不能移动的指针。</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#const关键字" class="sidebar-link">const关键字</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#数组和指针的区别" class="sidebar-link" style="padding-left:3rem;">数组和指针的区别</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#字符和字符串" class="sidebar-link">字符和字符串</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#字符串的输出" class="sidebar-link" style="padding-left:3rem;">字符串的输出</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#字符串的运算" class="sidebar-link">字符串的运算</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#copy" class="sidebar-link" style="padding-left:3rem;">copy</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#字符串的比较-strcmp" class="sidebar-link" style="padding-left:3rem;">字符串的比较（strcmp）</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#strlen-char-str-不包括-0" class="sidebar-link" style="padding-left:3rem;">strlen(char * str)，不包括'\0';</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#char-strcat-char-dest-const-char-src-将b连接在a的后面。" class="sidebar-link" style="padding-left:3rem;">char strcat(char dest, const char *src);将b连接在a的后面。</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#memset-char-a-0-20-清空字符串-使用20个0来填充。" class="sidebar-link" style="padding-left:3rem;">memset(char * a ,0,20),清空字符串，使用20个0来填充。</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#指向多个字符串" class="sidebar-link">指向多个字符串</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#main函数的函数原型" class="sidebar-link">main函数的函数原型</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#c程序的编译过程" class="sidebar-link">c程序的编译过程</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#_1-预处理" class="sidebar-link" style="padding-left:3rem;">1.预处理</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#_2-编译" class="sidebar-link" style="padding-left:3rem;">2.编译</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#_3-汇编" class="sidebar-link" style="padding-left:3rem;">3.汇编</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#_4-链接" class="sidebar-link" style="padding-left:3rem;">4.链接</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#预处理指令" class="sidebar-link">预处理指令</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#_1-头文件" class="sidebar-link" style="padding-left:3rem;">1.头文件</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#_2-宏" class="sidebar-link" style="padding-left:3rem;">2.宏</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#条件编译" class="sidebar-link">条件编译</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#内置宏变量" class="sidebar-link">内置宏变量</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#include-和-include-的区别" class="sidebar-link">#include 和 #include &quot;&quot;的区别</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#分文件调用" class="sidebar-link">分文件调用</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#static-和-extern" class="sidebar-link">static 和 extern</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#头文件的引用" class="sidebar-link">头文件的引用</a></li><li class="sidebar-sub-header"><a href="/clang/linux.html#make-和makefile" class="sidebar-link">make 和makefile</a></li></ul></li></ul></li><li><a href="/clang/struct.html" class="sidebar-link">结构体</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/point.html" class="sidebar-link">指针高级</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/stdlib.html" class="sidebar-link">标准库函数</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/datastruct.html" class="sidebar-link">数据结构主要研究的如何使用存储区(内存)存储数字</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc1.html" class="sidebar-link">复习:uc1</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc2.html" class="sidebar-link">uc2</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc3.html" aria-current="page" class="active sidebar-link">uc3</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc4.html" class="sidebar-link">uc4</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc5.html" class="sidebar-link">uc5</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc6.html" class="sidebar-link">uc6</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/uc7.html" class="sidebar-link">uc7</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/net1.html" class="sidebar-link">网络基础</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/net2.html" class="sidebar-link">ip地址</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/net3.html" class="sidebar-link">对tcp编程的代码进行封装</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/net-udp.html" class="sidebar-link">udp编程模型</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/thread.html" class="sidebar-link">线程基础</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/clang/signal.html" class="sidebar-link">信号阻塞</a><ul class="sidebar-sub-headers"></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="uc3"><a href="#uc3" class="header-anchor">#</a> uc3</h3> <p>umask</p> <p>指定文件没有那些权限</p> <p>新创建文件的权限等于mode&amp;~umask</p> <div class="language-eg line-numbers-mode"><pre class="language-text"><code>
mode  rwx,rw_,rw_ 766
umask ___,___,_w_ 002
创建的文件的权限位。  rwx,rw,r__

mode        111,110,110

umask取反    111，111，101

与的结果     111，110，100  ==  rwx,rw,r__

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>查看当前进程的umask.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>umask 
022

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>设置进程的umask</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>umask 042
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>返回值：</li></ul> <p>If successful, open() returns a non-negative integer, termed a file descriptor.  It returns -1 on failure, and sets errno to indicate the error.</p> <p>进程：进程的本质是程序执行过程中，对计算机资源的使用情况的描述，类似于视频是由一幅幅图片连起来的。</p> <p>文件描述符（a non-negative integer, termed a file descriptor）的本质：
每个进程都有一个pid来标识，pid对应的进程信息存在内核中的pcb（process contril block）中.是一个结构体，结构体中会把进程运行时使用的文件资源存在一个file结构体数组的字段中。当进程打开一个文件时，会把当前数组中未占用的最小数组下标返回。这个数组的下标就是文件描述符。pcb位于内核中，还会记录进程对其他计算机资源的使用。</p> <p><img src="/clang/file.png" alt="cb60ac2581291b05e14f27ce1c3ae538"></p> <p>bash中启动的进程的012文件描述符被占用了。</p> <p>0 标准输入 键盘 对应的宏 STDIN_FILENO</p> <p>1 标准输出 显示器 STDOUT_FILENO</p> <p>2 标准错误输出 显示器 STDERR_FILENO</p> <p>2.关闭文件</p> <p>#include &lt;unistd.h&gt;</p> <p>int close(int fildes);</p> <p>功能：delete a descriptor</p> <p>返回值：
Upon successful completion, a value of 0 is returned.Otherwise, a value of -1 is returned and the global integer variable errno is set to indicate the error.</p> <p>3.读文件的内容</p> <p>#include &lt;unistd.h&gt;</p> <p>ssize_t
read(int fildes, void *buf, size_t nbyte);</p> <ul><li><p>功能：
read() attempts to read nbyte bytes of data from the object referenced by the descriptor fildes into the buffer pointed to by buf.</p></li> <li><p>参数：
fildes 指向读取文件的文件描述符</p></li></ul> <p>buf 读取文件到缓冲区</p> <p>size_t 代表要读区的字节数</p> <ul><li>返回值</li></ul> <p>成功返回读取到的字节数，返回0代表到达文件的末尾
失败返回-1，errorn被设置</p> <ol start="4"><li>写入文件的内容
include &lt;unistd.h&gt;
ssize_t
write(int fildes, const void *buf, size_t nbyte);</li></ol> <ul><li>功能
write() attempts to write nbyte of data to the object referenced by the
descriptor fildes from the buffer pointed to by buf.</li> <li>参数</li></ul> <p>fildes 要写入的文件描述符</p> <p>buf 将buf中的写到文件中</p> <p>nbyte 写入的字节数</p> <ul><li>返回值</li></ul> <p>Upon successful completion the number of bytes which were written is returned.  Otherwise, a -1 is returned and the global variable errno is set to indicate the error.</p> <p>返回值为0时不为错，可能磁盘满了。</p> <p>5.修改文件的偏移</p> <p>#include &lt;unistd.h&gt;</p> <p>off_t lseek(int fildes, off_t offset, int whence);</p> <ul><li>功能</li></ul> <p>The lseek() function repositions the offset of the file descriptor fildes to the argument offset, according to the directive whence.  The argument fildes must be an open file descriptor.  lseek() repositions the file
pointer fildes as follows:
If whence is SEEK_SET, the offset is set to offset bytes.</p> <p>If whence is SEEK_CUR, the offset is set to its current location plus offset bytes.</p> <p>If whence is SEEK_END, the offset is set to the size of the file plus offset bytes.</p> <ul><li>参数</li></ul> <p>fildes 指定文件描述符只想的文件的偏移</p> <p>off_t  指定偏移多少个字节数</p> <p>whence 偏移的开始，可以为SEEK_SET（文件的开始），SEEK_CUR（当前偏移位置），SEEK_END（文件的结尾）</p> <ul><li>返回值
off_t 代表最终的相对文件开始位置的偏移量。</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>以指定类型(x1 = 16进制) c(ascii)形式显示文件的内容
$ od -tx1  -tc hello.txt
0000000    68  65  6c  6c  6f  20  77  6f  72  6c  64  21  0a            
           h   e   l   l   o       w   o   r   l   d   !  \n            
0000015
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>6.将文件映射到虚拟地址</p> <p>代码：map_file.c</p> <p>7.复制文件描述符</p> <p>文件描述符是pcb快中保存引用文件的结构体数组的下标，复制文件描述符使两个文件描述符指向同一个文件。利用这个可以输出文件重定向。</p> <p>#include &lt;unistd.h&gt;</p> <p>int
dup(int fildes);</p> <p>int
dup2(int fildes, int fildes2);</p> <ul><li><p>功能：
dup复制一个文件描述符，返回一个新的文件描述符，这个文件描述符是当前进程文件描述符表中的最小索引。
dup2复制一个文件描述符到指定的描述符，如果指定文件描述符被使用的话，系统会先关闭这个文件引用在区复制。</p></li> <li><p>返回值</p></li></ul> <p>Upon successful completion, the new file descriptor is returned.  Other-wise, a value of -1 is returned and the global integer variable errno is set to indicate the error.</p> <p>成功返回文件描述符，失败返回-1，errno被设置。</p> <h4 id="文件的元数据-meta"><a href="#文件的元数据-meta" class="header-anchor">#</a> 文件的元数据（meta）</h4> <p>每个文件都有一个inode结构体(inode又自己的编号)，这个结构体存放了文件的元数据和文件内容所在块的编号，一个inode可以对应多个文件。一个块包含磁盘上的多个扇区（一般是4个），每个扇区的大小是512个字节。
<img src="/clang/inode.png" alt="16215cc36d11afc861f873e8e621645c"></p> <p>查看文件的inode编号</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>
<span class="token function">ls</span> -li

<span class="token number">1573616</span> -rwxr-xr-x  <span class="token number">1</span> yiluhuakai yiluhuakai  <span class="token number">8648</span> <span class="token number">2</span>月  <span class="token number">13</span> <span class="token number">23</span>:53 a.out

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>第一个参数代表的是文件的inode编号。</p> <p>硬链接</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>yiluhuakai@debian:~/oc$ <span class="token function">ln</span> hello.m  hello
yiluhuakai@debian:~/oc$ <span class="token function">ls</span> -li
总用量 <span class="token number">8</span>
<span class="token number">1589381</span> -rw-r--r-- <span class="token number">2</span> yiluhuakai yiluhuakai <span class="token number">190</span> <span class="token number">2</span>月  <span class="token number">14</span> 00:10 hello
<span class="token number">1589381</span> -rw-r--r-- <span class="token number">2</span> yiluhuakai yiluhuakai <span class="token number">190</span> <span class="token number">2</span>月  <span class="token number">14</span> 00:10 hello.m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>硬链接相当于给文件一个别名，两个文件名对应一个inode.文件权限旁边的数字代表的是硬链接的个数。</p> <p>软连接</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>yiluhuakai@debian:~/oc$ <span class="token function">ln</span> -s hello.m hello.c
yiluhuakai@debian:~/oc$ <span class="token function">ls</span>
hello  hello.c  hello.m
yiluhuakai@debian:~/oc$ <span class="token function">ls</span> -li
总用量 <span class="token number">8</span>
<span class="token number">1589381</span> -rw-r--r-- <span class="token number">2</span> yiluhuakai yiluhuakai <span class="token number">190</span> <span class="token number">2</span>月  <span class="token number">14</span> 00:10 hello
<span class="token number">1589359</span> lrwxrwxrwx <span class="token number">1</span> yiluhuakai yiluhuakai   <span class="token number">7</span> <span class="token number">5</span>月  <span class="token number">31</span> <span class="token number">22</span>:05 hello.c -<span class="token operator">&gt;</span> hello.m
<span class="token number">1589381</span> -rw-r--r-- <span class="token number">2</span> yiluhuakai yiluhuakai <span class="token number">190</span> <span class="token number">2</span>月  <span class="token number">14</span> 00:10 hello.m
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>软件接文件和原文件的inode是不同的。软连接的inode中块编号保存的是硬链接文件的名称。通过名称可以找源文件的inode,然后访问磁盘上对应位置的内容，所以用cat打印文件的内容，看到的结果是一样的。</p> <h4 id="查看文件的元信息"><a href="#查看文件的元信息" class="header-anchor">#</a> 查看文件的元信息</h4> <p>#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;unistd.h&gt;
int stat(const char *pathname, struct stat *buf);</p> <ul><li><p>函数作用
These functions return information about a file, in the buffer pointed to by buf.</p></li> <li><p>参数
path 文件名
buf  返回文件元信息的结构体</p></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>struct stat {
               dev_t     st_dev;         /* ID of device containing file */
               ino_t     st_ino;         /* inode number */
               mode_t    st_mode;        /* file type and mode */
               nlink_t   st_nlink;       /* number of hard links */
               uid_t     st_uid;         /* user ID of owner */
               gid_t     st_gid;         /* group ID of owner */
               dev_t     st_rdev;        /* device ID (if special file) */
               off_t     st_size;        /* total size, in bytes */
               blksize_t st_blksize;     /* blocksize for filesystem I/O */
               blkcnt_t  st_blocks;      /* number of 512B blocks allocated */

               /* Since Linux 2.6, the kernel supports nanosecond
                  precision for the following timestamp fields.
                  For the details before Linux 2.6, see NOTES. */

               struct timespec st_atim;  /* time of last access */
               struct timespec st_mtim;  /* time of last modification */
               struct timespec st_ctim;  /* time of last status change */

           #define st_atime st_atim.tv_sec      /* Backward compatibility */
           #define st_mtime st_mtim.tv_sec
           #define st_ctime st_ctim.tv_sec
           };
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><ul><li>返回值</li></ul> <p>On success, zero is returned.  On error, -1 is returned, and errno is set appropriately.</p> <ul><li>上面的结构体中定义了宏变量，用来代表另一个结构体的字段</li></ul> <p>代码参见 : file_message/t_stat.c</p> <h3 id="uid和gid"><a href="#uid和gid" class="header-anchor">#</a> uid和gid</h3> <p>uid和gid是系统中标示用户和用户组的，我们一般看到的和使用的是用户和用户组的名字。</p> <p>linux下查看用户的相关信息</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cat</span> /etc/passwd<span class="token operator">|</span><span class="token function">grep</span> root
root:x:0:0:root:/root:/bin/bash
<span class="token function">cat</span> /etc/passwd<span class="token operator">|</span><span class="token function">grep</span> bruce
bruce:x:1000:1000:bruce,,,:/home/bruce:/bin/bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>冒号是分隔符。
第一列代表用户名，第二列是否有密码，第三列代表了uid,第四列是gid,第五列是用户的信息，第六列是用户的家目录，第七列是用户登陆时执行的第一个程序。</p> <p>linux下查看用户组信息</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cat</span> /etc/group<span class="token operator">|</span><span class="token function">grep</span> bruce
adm:x:4:syslog,bruce
cdrom:x:24:bruce
sudo:x:27:bruce
dip:x:30:bruce
plugdev:x:46:bruce
lpadmin:x:120:bruce
lxd:x:131:bruce
bruce:x:1000:
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>冒号是分隔符，第一列是用户的用户组名，第二列代表是否有密码，第三列代表用户组id,第四列是用户成员。</p> <h3 id="获取用户信息和用户组信息"><a href="#获取用户信息和用户组信息" class="header-anchor">#</a> 获取用户信息和用户组信息</h3> <p>#include &lt;sys/types.h&gt;
#include &lt;pwd.h&gt;</p> <p>struct passwd *getpwuid(uid_t uid);</p> <ul><li>功能</li></ul> <p>The getpwuid() function returns a pointer to a structure containing the
broken-out  fields  of the record in the password database that matches the user ID uid.</p> <ul><li>参数 uid(用户组id)</li> <li>返回值</li></ul> <p>成功返回paswd结构体指针，失败返回NULL,errorn被设置。</p> <p>passwd结构体：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>struct <span class="token function">passwd</span> <span class="token punctuation">{</span>
               char   *pw_name<span class="token punctuation">;</span>       /* username */
               char   *pw_passwd<span class="token punctuation">;</span>     /* user password */
               uid_t   pw_uid<span class="token punctuation">;</span>        /* user ID */
               gid_t   pw_gid<span class="token punctuation">;</span>        /* group ID */
               char   *pw_gecos<span class="token punctuation">;</span>      /* user information */
               char   *pw_dir<span class="token punctuation">;</span>        /* home directory */
               char   *pw_shell<span class="token punctuation">;</span>      /* shell program */
           <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>#include &lt;sys/types.h&gt;
#include &lt;grp.h&gt;</p> <p>struct group *getgrgid(gid_t gid);</p> <ul><li>返回用户组的信息</li> <li>参数用户组id</li> <li>返回值
成功返回group结构体的指针，失败返回NULL,errorn被设置。</li></ul> <p>group结构体：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code> struct group <span class="token punctuation">{</span>
               char   *gr_name<span class="token punctuation">;</span>        /* group name */
               char   *gr_passwd<span class="token punctuation">;</span>      /* group password */
               gid_t   gr_gid<span class="token punctuation">;</span>         /* group ID */
               char  **gr_mem<span class="token punctuation">;</span>         /* NULL-terminated array of pointers
                                          to names of group members */
           <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="时间相关的函数"><a href="#时间相关的函数" class="header-anchor">#</a> 时间相关的函数</h3> <p>#include &lt;time.h&gt;
char *ctime(const time_t *timep);</p> <ul><li>描述</li></ul> <p>毫秒数转成时间戳字符串</p> <ul><li><p>参数
timep是距离1970.1.1的毫秒数变量的地址</p></li> <li><p>返回值</p></li></ul> <p>成功返回时间戳，失败返回NULL.</p> <h3 id="查看文件的权限"><a href="#查看文件的权限" class="header-anchor">#</a> 查看文件的权限</h3> <p>stat函数返回的结构体中包含文件的权限（st_mode），st_mode返回一个无符号整型。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 八进制显示
mode of file:100664
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>10代表文件的类型，0代表文件的三个可执行权限组成的权限，后面的9位代表文件的权限。可以在man 7 inode中查看。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>The following mask values are defined for the file type:

           S_IFMT     0170000   bit mask for the file type bit field

           S_IFSOCK   0140000   socket
           S_IFLNK    0120000   symbolic link
           S_IFREG    0100000   regular file
           S_IFBLK    0060000   block device
           S_IFDIR    0040000   directory
           S_IFCHR    0020000   character device
           S_IFIFO    0010000   FIFO

       Thus, to test for a regular file (for example), one could write:

           stat(pathname, &amp;sb);
           if ((sb.st_mode &amp; S_IFMT) == S_IFREG) {
               /* Handle regular file */
           }

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>将文件的权限和S_IFMT 与可以取得文件类型。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#最前面的0代表9进制
st_mode 0100664 -&gt;(2进制)001 000 110 110 100 
S_IFMT  0170000        001 111 000 000 000     

按位与  010000          001 000 000 000 000
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>与会除了文件类型的位置，其他位置的字段都是0，然后与对应的宏进行比较，得到的就是文件的类型。</p> <p>The following mask values are defined for the file mode component of the st_mode field:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>S_ISUID     04000   set-user-ID bit (see execve(2))
           S_ISGID     02000   set-group-ID bit (see below)
           S_ISVTX     01000   sticky bit (see below)

           S_IRWXU     00700   owner has read, write, and execute permission
           S_IRUSR     00400   owner has read permission
           S_IWUSR     00200   owner has write permission
           S_IXUSR     00100   owner has execute permission

           S_IRWXG     00070   group has read, write, and execute permission
           S_IRGRP     00040   group has read permission
           S_IWGRP     00020   group has write permission
           S_IXGRP     00010   group has execute permission

           S_IRWXO     00007   others (not in group) have read,  write,  and
                               execute permission
           S_IROTH     00004   others have read permission
           S_IWOTH     00002   others have write permission
           S_IXOTH     00001   others have execute permission
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>检测用户组是否有可读权限且将它以字符的形的形式输出。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>st.st_mode &amp; S_IRUSR ?'r':'_'
st.st_mode &amp; S_IWUSR ?'w':'_'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/clang/uc2.html" class="prev">
        uc2
      </a></span> <span class="next"><a href="/clang/uc4.html">
        uc4
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9b56a05a.js" defer></script><script src="/assets/js/2.b22280cb.js" defer></script><script src="/assets/js/22.1419ba41.js" defer></script>
  </body>
</html>
